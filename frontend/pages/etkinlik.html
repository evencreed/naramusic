<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Etkinlikler</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Site CSS -->
  <link rel="stylesheet" href="../css/styles.css">

  <!-- Bu blok index.html ile bire bir aynƒ± g√∂rsel dili saƒülar -->
  <style>
    :root{ --bg:#0b0b0b; --text:#eaeaea; --panel:#121214; --muted:#9aa3ae; --accent:#77c2ff; --accent-contrast:#0a1118; --border: rgba(255,255,255,0.06); --elev-1: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); --input-bg:#0f1113; }
    :root[data-theme="light"]{ --bg:#f8fafc; --text:#0f172a; --panel:#ffffff; --muted:#5b6778; --accent:#2563eb; --accent-contrast:#ffffff; --border: rgba(15,23,42,0.08); --elev-1: linear-gradient(180deg, rgba(2,6,23,0.02), rgba(2,6,23,0.01)); --input-bg:#f1f5f9; }
    html,body{height:100%}
    body{
      background:var(--bg);
      color:var(--text);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      padding-top:72px;
    }
    .topbar{
      position:fixed; top:0; left:0; right:0; height:40px;
      background:var(--panel); z-index:1040;
      border-bottom:1px solid var(--border);
    }
    .topbar .container{height:100%; display:flex; align-items:center; gap:12px; font-size:13px}

    .mainnav{
      position:fixed; top:40px; left:0; right:0; z-index:1039;
      border-bottom:1px solid var(--border);
      background:transparent;
    }
    .navbar-brand{font-weight:800; letter-spacing:.6px}
    .nav-link{color:color-mix(in oklab, var(--text) 85%, transparent)}
    .nav-link:hover{color:var(--accent)}

    .hero .carousel-item{height:280px}
    .hero .carousel-item img{object-fit:cover; height:100%; width:100%; filter:brightness(.6)}
    .hero .carousel-caption{bottom:20px; left:24px; right:auto; text-align:left}
    .hero .carousel-caption h3{font-weight:800}

    main.container{max-width:1150px}
    .content-left{min-height:400px}
    .card{background:var(--elev-1); border:1px solid var(--border)}
    .card .meta{font-size:12px; color:var(--muted)}
    .post-thumb{height:120px; object-fit:cover; width:100%; border-radius:.25rem}

    .sidebar .widget{background:transparent; border:1px solid var(--border); padding:14px; margin-bottom:16px}
    .sidebar h6{font-size:14px; margin-bottom:10px}
    .small-list .item{display:flex; gap:10px; align-items:flex-start; margin-bottom:10px}
    .small-list img{width:72px; height:56px; object-fit:cover; border-radius:4px}

    @media (max-width:991px){
      .mainnav{top:0}
      body{padding-top:56px}
      .topbar{display:none}
      .hero .carousel-item{height:200px}
    }
    :root[data-theme="light"] .text-light{ color: var(--text) !important; }
    :root[data-theme="light"] .bg-dark{ background-color: var(--input-bg) !important; }
    :root[data-theme="light"] .form-control.bg-dark,
    :root[data-theme="light"] .form-select.bg-dark{ background-color: var(--input-bg) !important; color: var(--text) !important; border-color: var(--border) !important; }
    :root[data-theme="light"] .btn-outline-light{ color: var(--text) !important; border-color: var(--border) !important; }
    :root[data-theme="light"] .btn-outline-light:hover{ background: var(--text) !important; color: var(--accent-contrast) !important; }
    :root[data-theme="light"] .badge.bg-secondary{ background-color: color-mix(in oklab, var(--text) 10%, transparent) !important; color: var(--text) !important; }
  </style>
</head>
<body data-category="etkinlik">

  <!-- √úst ince bar -->
  <div class="topbar d-none d-lg-block">
    <div class="container">
      <div class="me-auto small text-muted">Nara M√ºzik ‚Äî M√ºzik tartƒ±≈üma topluluƒüu</div>
      <div class="d-flex gap-3">
        <a href="#" class="text-muted">About</a>
        <a href="#" class="text-muted">Contact</a>
        <a href="#" class="text-muted" data-bs-toggle="modal" data-bs-target="#createPostModal">Submit</a>
      </div>
    </div>
  </div>

  <!-- NAVBAR (index ile aynƒ±) -->
  <nav class="navbar navbar-expand-lg navbar-dark mainnav" id="mainNavbar">
    <div class="container-fluid">
      <div class="d-flex align-items-center">
        <button class="btn btn-outline-light me-2 d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sideMenu">‚ò∞</button>
        <a class="navbar-brand me-3" href="../index.html" data-lang="home">Nara M√ºzik</a>

        <!-- desktop links -->
        <div class="d-none d-lg-flex align-items-center gap-2">
          <a class="nav-link px-2" href="yenimuzik.html" data-lang="newMusic">Yeni M√ºzik</a>
          <a class="nav-link px-2" href="endustri.html" data-lang="industry">End√ºstri Haberleri</a>
          <a class="nav-link px-2" href="degerlendirme.html" data-lang="review">Deƒüerlendirme</a>
          <a class="nav-link px-2" href="album.html" data-lang="album">Alb√ºm ƒ∞nceleme</a>
          <a class="nav-link px-2" href="roportaj.html" data-lang="interview">R√∂portajlar</a>
          <a class="nav-link px-2" href="etkinlik.html" data-lang="event">Etkinlikler</a>
          <a class="nav-link px-2" href="dizifilm.html" data-lang="series">Dizi & Filmler</a>
        </div>
      </div>

      <div class="d-flex ms-auto align-items-center gap-2">
        <div class="d-none d-md-block">
          <input class="form-control form-control-sm bg-dark text-light border-0" style="width:220px" data-placeholder-lang="search" placeholder="Ara...">
        </div>
        <select id="language-toggle">
          <option value="en">EN</option>
          <option value="tr">TR</option>
        </select>
        <button id="themeToggle" class="btn btn-outline-light btn-sm">‚òÄÔ∏è</button>
        <button class="btn btn-success btn-sm d-none d-md-inline" data-bs-toggle="modal" data-bs-target="#createPostModal" data-lang="newPost">Yeni G√∂nderi</button>
        <div id="authButtons" class="d-flex gap-1">
          <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#loginModal">Giri≈ü</button>
          <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#registerModal">Kayƒ±t</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Mobil offcanvas men√º -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sideMenu">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Kategoriler</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="list-unstyled mb-0">
        <li><a href="yenimuzik.html">Yeni M√ºzik</a></li>
        <li><a href="endustri.html">End√ºstri Haberleri</a></li>
        <li><a href="degerlendirme.html">Deƒüerlendirme</a></li>
        <li><a href="album.html">Alb√ºm ƒ∞nceleme</a></li>
        <li><a href="roportaj.html">R√∂portajlar</a></li>
        <li><a href="etkinlik.html">Etkinlikler</a></li>
        <li><a href="dizifilm.html">Dizi ve Filmler</a></li>
      </ul>
    </div>
  </div>

  <!-- Kategori hero -->
  <section class="hero container mt-4">
    <div class="carousel slide">
      <div class="carousel-inner rounded">
        <div class="carousel-item active">
          <img src="https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=1600&auto=format&fit=crop" class="d-block w-100" alt="Yeni M√ºzik">
          <div class="carousel-caption text-start">
            <h3>Etkinlikler</h3>
            <p class="d-none d-md-block">Konserler ve t√ºm m√ºzik etkinlikleri</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ƒ∞ki s√ºtun: sol liste, saƒü widget -->
  <main class="container mt-4">
    <div class="row g-4">
      <div class="col-lg-8 content-left">
        <h5 class="mb-3">üÜï Bu kategorideki g√∂nderiler</h5>
        <div class="row g-3" id="categoryPosts"><!-- JS dolduracak --></div>
      </div>

      <aside class="col-lg-4 sidebar">
        <div class="widget">
          <h6>üîç Pop√ºler</h6>
          <div class="small-list" id="sidebarPopularPosts">
            <div class="text-center py-3">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Y√ºkleniyor...</span>
              </div>
              <div class="small text-muted mt-2">Pop√ºler g√∂nderiler y√ºkleniyor...</div>
            </div>
          </div>
        </div>

        <div class="widget">
          <h6>üßæ Son Yorumlar</h6>
          <div class="small-list" id="sidebarRecentComments">
            <div class="text-center py-3">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Y√ºkleniyor...</span>
              </div>
              <div class="small text-muted mt-2">Son yorumlar y√ºkleniyor...</div>
            </div>
          </div>
        </div>

        <div class="widget">
          <h6>üóÇ Kategoriler</h6>
          <div class="d-flex flex-wrap gap-2">
            <a href="yenimuzik.html" class="badge bg-secondary text-light">Yeni M√ºzik</a>
            <a href="endustri.html" class="badge bg-secondary text-light">End√ºstri</a>
            <a href="degerlendirme.html" class="badge bg-secondary text-light">Deƒüerlendirme</a>
            <a href="album.html" class="badge bg-secondary text-light">Alb√ºm</a>
            <a href="roportaj.html" class="badge bg-secondary text-light">R√∂portaj</a>
            <a href="etkinlik.html" class="badge bg-secondary text-light">Etkinlik</a>
            <a href="dizifilm.html" class="badge bg-secondary text-light">Dizi&Film</a>
          </div>
        </div>

        <div class="widget text-center">
          <h6>Topluluk</h6>
          <p class="small text-muted mb-0">√úyeler katƒ±lƒ±p g√∂nderi payla≈üabilir. Giri≈ü/Kayƒ±t ile ba≈ülayƒ±n.</p>
          <div class="mt-2">
            <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#registerModal">√úye Ol</button>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <!-- Footer -->
  <footer class="text-center py-4 mt-5">
    <div class="container">
      <small class="text-muted">¬© <span id="year"></span> MyForum ‚Äî T√ºm haklarƒ± saklƒ±dƒ±r.</small>
    </div>
  </footer>

  <!-- Modals (index ile aynƒ± modallarƒ± kullanƒ±yoruz) -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="loginForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Giri≈ü Yap</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="email" type="email" class="form-control mb-2" placeholder="Email" required>
          <input name="password" type="password" class="form-control" placeholder="Parola" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Giri≈ü</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="registerForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Kayƒ±t Ol</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="username" class="form-control mb-2" placeholder="Kullanƒ±cƒ± Adƒ±" required>
          <input name="email" type="email" class="form-control mb-2" placeholder="Email" required>
          <input name="password" type="password" class="form-control" placeholder="Parola" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success w-100">Kayƒ±t Ol</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="createPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <form id="createPostForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Yeni G√∂nderi Olu≈ütur</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="title" class="form-control mb-2" placeholder="Ba≈ülƒ±k" required>
          <select name="category" class="form-select mb-2">
            <option value="yenimuzik">Yeni M√ºzik</option>
            <option value="endustri">End√ºstri Haberleri</option>
            <option value="degerlendirme">Deƒüerlendirme</option>
            <option value="album">Alb√ºm ƒ∞nceleme</option>
            <option value="roportaj">R√∂portajlar</option>
            <option value="etkinlik">Etkinlikler</option>
            <option value="dizifilm">Dizi & Filmler</option>
          </select>
          <textarea name="content" rows="12" class="form-control mb-2" placeholder="ƒ∞√ßerik" required></textarea>
          <div class="row g-2">
            <div class="col-md-6">
              <input name="mediaUrl" type="url" class="form-control" placeholder="Fotoƒüraf/GIF URL (opsiyonel)">
            </div>
            <div class="col-md-6">
              <input name="linkUrl" type="url" class="form-control" placeholder="Harici Link (opsiyonel)">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Payla≈ü</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/app.js"></script>
  <script src="../js/lang.js"></script>
  <script>
    // yƒ±l
    document.getElementById('year').textContent = new Date().getFullYear();
    const root = document.documentElement; const savedTheme = localStorage.getItem('theme') || 'dark';
    function applyTheme(theme){ const nav = document.getElementById('mainNavbar'); if(theme==='light'){ root.setAttribute('data-theme','light'); nav.classList.remove('navbar-dark'); nav.classList.add('navbar-light'); document.getElementById('themeToggle').textContent='üåô'; } else { root.removeAttribute('data-theme'); nav.classList.remove('navbar-light'); nav.classList.add('navbar-dark'); document.getElementById('themeToggle').textContent='‚òÄÔ∏è'; } }
    applyTheme(savedTheme);
    document.getElementById('themeToggle').addEventListener('click',()=>{ const next = root.getAttribute('data-theme')==='light' ? 'dark':'light'; localStorage.setItem('theme', next); applyTheme(next); });

    // login/register/create stublarƒ± (backend baƒülayƒ±nca deƒüi≈ütir)
    document.getElementById('loginForm').addEventListener('submit', e=>{
      e.preventDefault();
      bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
      alert('Giri≈ü sim√ºlasyonu.');
    });
    document.getElementById('registerForm').addEventListener('submit', e=>{
      e.preventDefault();
      bootstrap.Modal.getInstance(document.getElementById('registerModal')).hide();
      alert('Kayƒ±t sim√ºlasyonu.');
    });
    document.getElementById('createPostForm').addEventListener('submit', e=>{
      e.preventDefault();
      bootstrap.Modal.getInstance(document.getElementById('createPostModal')).hide();
      alert('G√∂nderi olu≈üturma sim√ºlasyonu.');
    });

    // Load sidebar data
    async function loadSidebarData() {
      try {
        const base = (typeof window !== 'undefined' && window.__API_BASE__) ? window.__API_BASE__ : (location.hostname.includes('localhost') ? 'http://localhost:4000' : 'https://naramusic.onrender.com');
        
        // Load popular posts for sidebar
        const popularRes = await fetch(`${base}/api/posts/popular?limit=3`);
        const popularPosts = await popularRes.json();
        
        const sidebarPopular = document.getElementById('sidebarPopularPosts');
        if (popularPosts.length > 0) {
          sidebarPopular.innerHTML = popularPosts.map(post => `
            <div class="item">
              <img src="${post.imageUrl || 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=400&auto=format&fit=crop'}" alt="${post.title}" style="width: 50px; height: 50px; object-fit: cover;">
              <div>
                <div class="fw-semibold">${post.title}</div>
                <div class="meta">${post.views || 0} okuma</div>
              </div>
            </div>
          `).join('');
        } else {
          sidebarPopular.innerHTML = '<div class="text-muted small">Hen√ºz pop√ºler g√∂nderi yok.</div>';
        }

        // Load recent comments for sidebar
        const commentsRes = await fetch(`${base}/api/comments/recent?limit=3`);
        const recentComments = await commentsRes.json();
        
        const sidebarComments = document.getElementById('sidebarRecentComments');
        if (recentComments.length > 0) {
          sidebarComments.innerHTML = recentComments.map(comment => `
            <div class="item">
              <div>
                <div class="fw-semibold">${comment.author || 'Anonim'}</div>
                <div class="meta">"${comment.content.substring(0, 50)}${comment.content.length > 50 ? '...' : ''}" ‚Ä¢ ${new Date(comment.createdAt).toLocaleDateString('tr-TR')}</div>
              </div>
            </div>
          `).join('');
        } else {
          sidebarComments.innerHTML = '<div class="text-muted small">Hen√ºz yorum yok.</div>';
        }

      } catch (error) {
        console.error('Sidebar data loading error:', error);
        
        // Show error state
        document.getElementById('sidebarPopularPosts').innerHTML = '<div class="text-muted small">Veri y√ºklenemedi.</div>';
        document.getElementById('sidebarRecentComments').innerHTML = '<div class="text-muted small">Veri y√ºklenemedi.</div>';
      }
    }

    // Load sidebar data on page load
    loadSidebarData();
  </script>
</body>
</html>
