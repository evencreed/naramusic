<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Albüm İnceleme — Nara Müzik</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Site CSS -->
  <link rel="stylesheet" href="../css/styles.css">

  <style>
    .album-card { transition: transform 0.2s ease; }
    .album-card:hover { transform: translateY(-5px); }
    .album-cover { width: 100%; height: 200px; object-fit: cover; border-radius: 8px; }
    .play-count { font-size: 0.9rem; color: var(--muted); }
    .comment-item { border-bottom: 1px solid var(--border); padding: 0.75rem 0; }
    .comment-item:last-child { border-bottom: none; }
  </style>
</head>
<body>
  <!-- Navbar will be injected by app.js -->

  <!-- Hero Section -->
  <section class="hero-section py-5">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <h1 class="display-5 fw-bold mb-3">Albüm İnceleme</h1>
          <p class="lead text-muted">En çok dinlenen ve tartışılan albümleri keşfedin, yorumlarınızı paylaşın ve favori albümlerinizi kaydedin.</p>
    </div>
        <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
              <h6 class="mb-0">Albüm Ara</h6>
            </div>
            <div class="card-body">
              <input id="albumSearchInput" class="form-control mb-2" placeholder="Albüm adı yazın...">
              <button id="searchButton" class="btn btn-primary w-100">Ara</button>
              <div id="albumSearchResults" class="mt-3"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Popular Albums -->
  <main class="container py-4">
    <section class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Popüler Albümler</h2>
        <div class="btn-group" role="group">
          <input type="radio" class="btn-check" name="sortOptions" id="sortByPopular" checked>
          <label class="btn btn-outline-primary" for="sortByPopular">Popüler</label>
          <input type="radio" class="btn-check" name="sortOptions" id="sortByRecent">
          <label class="btn btn-outline-primary" for="sortByRecent">Yeni</label>
          <input type="radio" class="btn-check" name="sortOptions" id="sortByRating">
          <label class="btn btn-outline-primary" for="sortByRating">Puan</label>
        </div>
      </div>
      <div id="albumsGrid" class="row g-4"></div>
    </section>

    <!-- My Favorites -->
    <section class="mb-5" id="favoritesSection" style="display: none;">
      <h2 class="mb-4">Favori Albümlerim</h2>
      <div id="favoritesGrid" class="row g-4"></div>
    </section>
  </main>

  <!-- Footer will be injected by app.js -->

  <!-- Modals -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="loginForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Giriş Yap</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="email" type="email" class="form-control mb-2" placeholder="Email" required>
          <input name="password" type="password" class="form-control" placeholder="Parola" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Giriş</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="registerForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Kayıt Ol</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="username" class="form-control mb-2" placeholder="Kullanıcı Adı" required>
          <input name="email" type="email" class="form-control mb-2" placeholder="Email" required>
          <input name="password" type="password" class="form-control" placeholder="Parola" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success w-100">Kayıt Ol</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="createPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <form id="newPostForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Yeni Gönderi Oluştur</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input id="postTitle" name="title" class="form-control mb-2" placeholder="Başlık" required>
          <select id="postCategory" name="category" class="form-select mb-2">
            <option value="album">Albüm İnceleme</option>
            <option value="yenimuzik">Yeni Müzik</option>
            <option value="endustri">Endüstri Haberleri</option>
            <option value="degerlendirme">Değerlendirme</option>
            <option value="roportaj">Röportajlar</option>
            <option value="etkinlik">Etkinlikler</option>
            <option value="dizifilm">Dizi & Filmler</option>
          </select>
          <textarea id="postContent" name="content" rows="6" class="form-control" placeholder="İçerik"></textarea>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Paylaş</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Album Details Modal -->
  <div class="modal fade" id="albumModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="albumModalTitle">Albüm Detayları</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="albumModalBody">
          <!-- Album details will be loaded here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
          <button type="button" class="btn btn-primary" id="addToFavoritesBtn">Favorilere Ekle</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/app.js"></script>
  <script src="../js/lang.js"></script>
  <script>
  (async function(){
      'use strict';
      document.getElementById('year').textContent = new Date().getFullYear();

    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
      const root = document.documentElement;
      function applyTheme(theme){
        const nav = document.getElementById('mainNavbar');
        if(theme === 'light'){
          root.setAttribute('data-theme','light');
        themeToggle.textContent = '🌙';
        nav.classList.remove('navbar-dark'); nav.classList.add('navbar-light');
        } else {
          root.removeAttribute('data-theme');
        themeToggle.textContent = '☀️';
        nav.classList.remove('navbar-light'); nav.classList.add('navbar-dark');
      }
      }
      const savedTheme = localStorage.getItem('theme') || 'dark';
      applyTheme(savedTheme);
    themeToggle.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      localStorage.setItem('theme', next); applyTheme(next);
    });

    // Mock album data
    const mockAlbums = [
      { id: 1, title: 'Midnight Memories', artist: 'One Direction', cover: 'https://picsum.photos/300/300?random=1', plays: 12500, rating: 4.5 },
      { id: 2, title: 'Red (Taylor\'s Version)', artist: 'Taylor Swift', cover: 'https://picsum.photos/300/300?random=2', plays: 23400, rating: 4.8 },
      { id: 3, title: 'After Hours', artist: 'The Weeknd', cover: 'https://picsum.photos/300/300?random=3', plays: 18900, rating: 4.6 },
      { id: 4, title: 'Fine Line', artist: 'Harry Styles', cover: 'https://picsum.photos/300/300?random=4', plays: 15600, rating: 4.4 },
      { id: 5, title: 'Folklore', artist: 'Taylor Swift', cover: 'https://picsum.photos/300/300?random=5', plays: 21200, rating: 4.9 },
      { id: 6, title: 'Future Nostalgia', artist: 'Dua Lipa', cover: 'https://picsum.photos/300/300?random=6', plays: 17800, rating: 4.7 }
    ];

    let favorites = JSON.parse(localStorage.getItem('albumFavorites') || '[]');

    function renderAlbums(albums) {
      const grid = document.getElementById('albumsGrid');
      grid.innerHTML = albums.map(album => `
        <div class="col-md-6 col-lg-4">
          <div class="card album-card h-100">
            <img src="${album.cover}" class="album-cover" alt="${album.title}">
            <div class="card-body">
              <h6 class="card-title">${album.title}</h6>
              <p class="card-text text-muted">${album.artist}</p>
              <div class="d-flex justify-content-between align-items-center">
                <span class="play-count">${album.plays.toLocaleString()} dinlenme</span>
                <div class="btn-group">
                  <button class="btn btn-sm btn-outline-primary" onclick="viewAlbum(${album.id})">Görüntüle</button>
                  <button class="btn btn-sm ${favorites.includes(album.id) ? 'btn-danger' : 'btn-outline-danger'}" onclick="toggleFavorite(${album.id})">
                    ${favorites.includes(album.id) ? '❤️' : '🤍'}
                </button>
                </div>
              </div>
              <div class="mt-2">
                <span class="badge bg-warning">★ ${album.rating}</span>
              </div>
            </div>
          </div>
          </div>
      `).join('');
    }

    function renderFavorites() {
      const favoriteAlbums = mockAlbums.filter(album => favorites.includes(album.id));
      const grid = document.getElementById('favoritesGrid');
      const section = document.getElementById('favoritesSection');
      
      if (favoriteAlbums.length > 0) {
        section.style.display = 'block';
        grid.innerHTML = favoriteAlbums.map(album => `
          <div class="col-md-6 col-lg-4">
            <div class="card album-card h-100">
              <img src="${album.cover}" class="album-cover" alt="${album.title}">
              <div class="card-body">
                <h6 class="card-title">${album.title}</h6>
                <p class="card-text text-muted">${album.artist}</p>
                <button class="btn btn-sm btn-outline-primary" onclick="viewAlbum(${album.id})">Görüntüle</button>
              </div>
            </div>
          </div>
        `).join('');
      } else {
        section.style.display = 'none';
      }
    }

    window.viewAlbum = function(id) {
      const album = mockAlbums.find(a => a.id === id);
      if (!album) return;
      
      document.getElementById('albumModalTitle').textContent = album.title;
      document.getElementById('albumModalBody').innerHTML = `
        <div class="row">
          <div class="col-md-4">
            <img src="${album.cover}" class="img-fluid rounded" alt="${album.title}">
                  </div>
          <div class="col-md-8">
            <h5>${album.title}</h5>
            <p class="text-muted">${album.artist}</p>
            <p><strong>Dinlenme:</strong> ${album.plays.toLocaleString()}</p>
            <p><strong>Puan:</strong> ★ ${album.rating}/5</p>
            <div class="mt-3">
              <h6>Yorumlar</h6>
              <div class="comment-item">
                <strong>Müzik Sever:</strong> Harika bir albüm, her şarkısı ayrı bir başyapıt!
              </div>
              <div class="comment-item">
                <strong>Rock Fan:</strong> Bu sanatçının en iyi çalışması olmuş.
              </div>
            </div>
                </div>
              </div>
            `;
      
      new bootstrap.Modal(document.getElementById('albumModal')).show();
    };

    window.toggleFavorite = function(id) {
      const index = favorites.indexOf(id);
      if (index > -1) {
        favorites.splice(index, 1);
      } else {
        favorites.push(id);
      }
      localStorage.setItem('albumFavorites', JSON.stringify(favorites));
      renderAlbums(mockAlbums);
      renderFavorites();
    };

    // Album search
    document.getElementById('searchButton').addEventListener('click', () => {
      const query = document.getElementById('albumSearchInput').value.trim();
      const results = document.getElementById('albumSearchResults');
      
      if (query) {
        const filtered = mockAlbums.filter(album => 
          album.title.toLowerCase().includes(query.toLowerCase()) ||
          album.artist.toLowerCase().includes(query.toLowerCase())
        );
        
        if (filtered.length > 0) {
          results.innerHTML = filtered.map(album => `
            <div class="d-flex align-items-center mb-2 p-2 border rounded">
              <img src="${album.cover}" width="50" height="50" class="rounded me-2" alt="${album.title}">
              <div class="flex-grow-1">
                <div class="fw-bold">${album.title}</div>
                <small class="text-muted">${album.artist}</small>
              </div>
              <button class="btn btn-sm btn-outline-primary" onclick="viewAlbum(${album.id})">Görüntüle</button>
            </div>
          `).join('');
        } else {
          results.innerHTML = '<p class="text-muted">Sonuç bulunamadı.</p>';
        }
      } else {
        results.innerHTML = '';
      }
    });

    // Sort options
    document.querySelectorAll('input[name="sortOptions"]').forEach(radio => {
      radio.addEventListener('change', (e) => {
        let sorted = [...mockAlbums];
        switch(e.target.id) {
          case 'sortByPopular':
            sorted.sort((a, b) => b.plays - a.plays);
            break;
          case 'sortByRecent':
            sorted.reverse(); // Assume newer albums are at the end
            break;
          case 'sortByRating':
            sorted.sort((a, b) => b.rating - a.rating);
            break;
        }
        renderAlbums(sorted);
      });
    });

    // Initial render
    renderAlbums(mockAlbums);
    renderFavorites();
    
    })();
  </script>
</body>
</html>