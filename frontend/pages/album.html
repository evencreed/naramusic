<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Albüm</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Site CSS -->
  <link rel="stylesheet" href="../css/style.css">

  <!-- Theme tokens to mirror index.html -->
  <style>
    :root{
      --bg:#0b0b0b;
      --text:#eaeaea;
      --panel:#121214;
      --muted:#9aa3ae;
      --accent:#77c2ff;
      --accent-contrast:#0a1118;
      --border: rgba(255,255,255,0.06);
      --elev-1: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      --input-bg:#0f1113;
    }
    :root[data-theme="light"]{
      --bg:#f8fafc;
      --text:#0f172a;
      --panel:#ffffff;
      --muted:#5b6778;
      --accent:#2563eb;
      --accent-contrast:#ffffff;
      --border: rgba(15,23,42,0.08);
      --elev-1: linear-gradient(180deg, rgba(2,6,23,0.02), rgba(2,6,23,0.01));
      --input-bg:#f1f5f9;
    }
    html,body{height:100%}
    body{
      background:var(--bg);
      color:var(--text);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      padding-top:72px;
    }
    .topbar{
      position:fixed; top:0; left:0; right:0; height:40px;
      background:var(--panel); z-index:1040;
      border-bottom:1px solid var(--border);
    }
    .topbar .container{height:100%; display:flex; align-items:center; gap:12px; font-size:13px}

    .mainnav{
      position:fixed; top:40px; left:0; right:0; z-index:1039;
      border-bottom:1px solid var(--border);
      background:transparent;
    }
    .navbar-brand{font-weight:800; letter-spacing:.6px}
    .nav-link{color:color-mix(in oklab, var(--text) 85%, transparent)}
    .nav-link:hover{color:var(--accent)}
    main.container{max-width:1150px}

    .hero{
      background: var(--panel);
      border:1px solid var(--border);
      border-radius:.5rem;
      overflow:hidden;
    }
    .hero-cover{
      width:100%;
      max-width:220px;
      aspect-ratio: 1/1;
      border-radius:.5rem;
      object-fit:cover;
    }
    .badge-artist{
      background-color: color-mix(in oklab, var(--text) 10%, transparent);
      color: var(--text);
    }
    .card{background:var(--elev-1); border:1px solid var(--border)}
    .track-play{
      width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center;
      border-radius:50%;
    }
    .track-row:hover{ background-color: rgba(255,255,255,0.03); }
    .muted{ color: var(--muted); }

    /* Album Cards */
    .album-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
    }
    .album-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .album-cover {
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      border-radius: 8px;
    }
    .album-info {
      padding: 1rem;
    }
    .album-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      line-height: 1.3;
    }
    .album-artist {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }
    .album-year {
      color: var(--muted);
      font-size: 0.8rem;
    }
    .comment-section {
      border-top: 1px solid var(--border);
      padding: 1rem;
      background: rgba(255,255,255,0.02);
    }
    .comment-input {
      background: var(--input-bg);
      border: 1px solid var(--border);
      color: var(--text);
    }
    .comment-input:focus {
      background: var(--input-bg);
      border-color: var(--accent);
      color: var(--text);
      box-shadow: 0 0 0 0.2rem rgba(119, 194, 255, 0.25);
    }
    .comment-item {
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .comment-item:last-child {
      border-bottom: none;
    }
    .comment-author {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--accent);
    }
    .comment-date {
      font-size: 0.8rem;
      color: var(--muted);
    }
    .comment-text {
      margin-top: 0.25rem;
      line-height: 1.4;
    }

    @media (max-width:991px){
      .mainnav{top:0}
      body{padding-top:56px}
    }

    /* Light theme overrides for Bootstrap utility classes */
    :root[data-theme="light"] .text-light{ color: var(--text) !important; }
    :root[data-theme="light"] .bg-dark{ background-color: var(--input-bg) !important; }
    :root[data-theme="light"] .form-control.bg-dark,
    :root[data-theme="light"] .form-select.bg-dark{ background-color: var(--input-bg) !important; color: var(--text) !important; border-color: var(--border) !important; }
    :root[data-theme="light"] .btn-outline-light{ color: var(--text) !important; border-color: var(--border) !important; }
    :root[data-theme="light"] .btn-outline-light:hover{ background: var(--text) !important; color: var(--accent-contrast) !important; }
    :root[data-theme="light"] .badge.bg-secondary{ background-color: color-mix(in oklab, var(--text) 10%, transparent) !important; color: var(--text) !important; }
  </style>
</head>
<body>

  <!-- Top thin bar -->
  <div class="topbar d-none d-lg-block">
    <div class="container">
      <div class="me-auto small text-muted">Nara Müzik — Müzik tartışma topluluğu</div>
      <div class="d-flex gap-3">
        <a href="../index.html#about" class="text-muted">About</a>
        <a href="contact.html" class="text-muted">Contact</a>
        <a href="submit.html" class="text-muted" data-bs-toggle="modal" data-bs-target="#createPostModal">Submit</a>
      </div>
    </div>
  </div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark mainnav" id="mainNavbar">
    <div class="container-fluid">
      <div class="d-flex align-items-center">
        <button class="btn btn-outline-light me-2 d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sideMenu">☰</button>
        <a class="navbar-brand me-3" href="../index.html" data-lang="home">Nara Müzik</a>

        <div class="d-none d-lg-flex align-items-center gap-2">
          <a class="nav-link px-2" href="yenimuzik.html" data-lang="newMusic">Yeni Müzik</a>
          <a class="nav-link px-2" href="endustri.html" data-lang="industry">Endüstri Haberleri</a>
          <a class="nav-link px-2" href="degerlendirme.html" data-lang="review">Değerlendirme</a>
          <a class="nav-link px-2" href="album.html" data-lang="album">Albüm İnceleme</a>
          <a class="nav-link px-2" href="roportaj.html" data-lang="interview">Röportajlar</a>
          <a class="nav-link px-2" href="etkinlik.html" data-lang="event">Etkinlikler</a>
          <a class="nav-link px-2" href="dizifilm.html" data-lang="series">Dizi &amp; Filmler</a>
        </div>
      </div>

      <div class="d-flex ms-auto align-items-center gap-2">
        <div class="d-none d-md-block">
          <input id="globalSearch" class="form-control form-control-sm bg-dark text-light border-0" style="width:220px" data-placeholder-lang="search" placeholder="Ara...">
        </div>

        <select id="language-toggle">
          <option value="en">EN</option>
          <option value="tr">TR</option>
        </select>

        <button id="themeToggle" class="btn btn-outline-light btn-sm">☀️</button>
        <button class="btn btn-success btn-sm d-none d-md-inline" data-bs-toggle="modal" data-bs-target="#createPostModal" data-lang="newPost">Yeni Gönderi</button>

        <div id="authButtons" class="d-flex gap-1">
          <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#loginModal">Giriş</button>
          <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#registerModal">Kayıt</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Offcanvas -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sideMenu">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Kategoriler</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="list-unstyled mb-0">
        <li><a href="yenimuzik.html">Yeni Müzik</a></li>
        <li><a href="endustri.html">Endüstri Haberleri</a></li>
        <li><a href="degerlendirme.html">Değerlendirme</a></li>
        <li><a href="album.html">Albüm İnceleme</a></li>
        <li><a href="roportaj.html">Röportajlar</a></li>
        <li><a href="etkinlik.html">Etkinlikler</a></li>
        <li><a href="dizifilm.html">Dizi ve Filmler</a></li>
      </ul>
    </div>
  </div>

  <main class="container mt-4">
    <!-- Back link / breadcrumb -->
    <div class="mb-3">
      <a href="../index.html" class="text-decoration-none">&larr; Geri</a>
    </div>

    <!-- Page Header -->
    <section class="mb-4">
      <h1 class="h2 mb-2" data-lang="popularAlbums">Popüler Albümler</h1>
      <p class="text-muted" data-lang="popularAlbumsDesc">En çok dinlenen ve tartışılan albümleri keşfedin</p>
    </section>

    <!-- Loading State -->
    <div id="loadingState" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Yükleniyor...</span>
      </div>
      <p class="mt-2 text-muted" data-lang="loading">Albümler yükleniyor...</p>
    </div>

    <!-- Error State -->
    <div id="errorBox" class="alert alert-danger d-none"></div>

    <!-- Albums Grid -->
    <section id="albumsSection" class="d-none">
      <div class="row g-4" id="albumsGrid">
        <!-- Album cards will be inserted here -->
      </div>
      
      <!-- Load More Button -->
      <div class="text-center mt-4">
        <button id="loadMoreBtn" class="btn btn-outline-primary" data-lang="loadMore">
          Daha Fazla Albüm Yükle
        </button>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="text-center py-4 mt-5">
    <div class="container">
      <small class="text-muted">© <span id="year"></span> Nara Müzik</small>
    </div>
  </footer>

  <!-- Modals (login/register/create) to align with app.js behavior -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="loginForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Giriş Yap</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="email" type="email" class="form-control mb-2" placeholder="Email" required>
          <input name="password" type="password" class="form-control" placeholder="Parola" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Giriş</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="registerForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Kayıt Ol</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="username" class="form-control mb-2" placeholder="Kullanıcı Adı" required>
          <input name="email" type="email" class="form-control mb-2" placeholder="Email" required>
          <input name="password" type="password" class="form-control" placeholder="Parola" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success w-100">Kayıt Ol</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="createPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <form id="newPostForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Yeni Gönderi Oluştur</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input id="postTitle" name="title" class="form-control mb-2" placeholder="Başlık" required>
          <select id="postCategory" name="category" class="form-select mb-2">
            <option value="yenimuzik">Yeni Müzik</option>
            <option value="endustri">Endüstri Haberleri</option>
            <option value="degerlendirme">Değerlendirme</option>
            <option value="album">Albüm İnceleme</option>
            <option value="roportaj">Röportajlar</option>
            <option value="etkinlik">Etkinlikler</option>
            <option value="dizifilm">Dizi &amp; Filmler</option>
          </select>
          <div class="btn-toolbar mb-2" role="toolbar" aria-label="Editor toolbar">
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="bold"><strong>B</strong></button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="italic"><em>I</em></button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="strike">S</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="h2">H2</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="h3">H3</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="quote">“”</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="ul">• List</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="ol">1. List</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="task">[ ]</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="link">Link</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="image">🖼️</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="code"><code>{}</code></button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="codeblock">```</button>
            </div>
          </div>
          <div id="emojiPicker" class="card shadow-sm mb-2" style="display:none; position:absolute; z-index:2000; width:300px;">
            <div class="card-body py-2">
              <input type="text" class="form-control form-control-sm mb-2" id="emojiSearch" placeholder="Emoji ara…">
              <div id="emojiGrid" class="d-flex flex-wrap gap-1" style="max-height:200px; overflow:auto"></div>
            </div>
          </div>
          <div id="urlPopover" class="card shadow-sm mb-2" style="display:none; position:absolute; z-index:2000; width:320px;">
            <div class="card-body py-2">
              <div class="mb-2 small text-muted" id="urlPopoverTitle">Bağlantı ekle</div>
              <input type="url" class="form-control form-control-sm mb-2" id="urlPopoverInput" placeholder="https://...">
              <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-sm btn-outline-secondary" id="urlPopoverCancel">İptal</button>
                <button type="button" class="btn btn-sm btn-primary" id="urlPopoverOk">Ekle</button>
              </div>
            </div>
          </div>
          <div class="row g-2">
            <div class="col-md-6">
              <textarea id="postContent" name="content" rows="10" class="form-control" placeholder="İçerik (Markdown destekli)" required></textarea>
            </div>
            <div class="col-md-6">
              <div class="form-control" style="height:100%; overflow:auto; background: var(--input-bg); border-color: var(--border)">
                <div class="small text-muted mb-1">Önizleme</div>
                <div id="postPreview" class="markdown-body"></div>
              </div>
            </div>
          </div>
          <div class="row g-2 mt-1">
            <div class="col-md-6">
              <input id="postMediaUrl" name="mediaUrl" type="url" class="form-control" placeholder="Fotoğraf/GIF URL (opsiyonel)">
            </div>
            <div class="col-md-6">
              <input id="postLinkUrl" name="linkUrl" type="url" class="form-control" placeholder="Harici Link (opsiyonel)">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Paylaş</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Common app helpers (BACKEND_BASE, auth UI, theme, etc.) -->
  <script src="../js/app.js"></script>
  <script src="../js/lang.js"></script>

  <!-- Page inline logic -->
  <script>
    (function(){
      'use strict';
      // year
      document.getElementById('year').textContent = new Date().getFullYear();

      // Theme align with index
      const root = document.documentElement;
      const themeToggle = document.getElementById('themeToggle');
      function applyTheme(theme){
        const nav = document.getElementById('mainNavbar');
        if(theme === 'light'){
          root.setAttribute('data-theme','light');
          nav.classList.remove('navbar-dark');
          nav.classList.add('navbar-light');
          themeToggle.textContent = '🌙';
        } else {
          root.removeAttribute('data-theme');
          nav.classList.remove('navbar-light');
          nav.classList.add('navbar-dark');
          themeToggle.textContent = '☀️';
        }
      }
      const savedTheme = localStorage.getItem('theme') || 'dark';
      applyTheme(savedTheme);
      themeToggle.addEventListener('click', ()=>{
        const next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        localStorage.setItem('theme', next);
        applyTheme(next);
      });

      // Elements
      const loadingState = document.getElementById('loadingState');
      const albumsSection = document.getElementById('albumsSection');
      const albumsGrid = document.getElementById('albumsGrid');
      const errorBox = document.getElementById('errorBox');
      const loadMoreBtn = document.getElementById('loadMoreBtn');

      // State
      let currentPage = 1;
      let isLoading = false;
      let hasMore = true;

      // Last.fm API Key
      const LASTFM_API_KEY = 'd7fb4c5c6efa6075b6ff1f4a080ac024';
      const LASTFM_BASE_URL = 'https://ws.audioscrobbler.com/2.0/';

      // Load popular albums from Last.fm
      async function loadPopularAlbums(page = 1) {
        if (isLoading) return;
        isLoading = true;

        try {
          // Show loading state on first load
          if (page === 1) {
            loadingState.classList.remove('d-none');
            albumsSection.classList.add('d-none');
            errorBox.classList.add('d-none');
          }

          // Simulate API delay
          await new Promise(resolve => setTimeout(resolve, 1000));

          // Generate new albums for each page
          const generateNewAlbums = (page) => {
            const albumTemplates = [
              { name: "Midnights", artist: "Taylor Swift", playcount: "1250000" },
              { name: "SOS", artist: "SZA", playcount: "980000" },
              { name: "Harry's House", artist: "Harry Styles", playcount: "1100000" },
              { name: "Renaissance", artist: "Beyoncé", playcount: "850000" },
              { name: "Un Verano Sin Ti", artist: "Bad Bunny", playcount: "1200000" },
              { name: "30", artist: "Adele", playcount: "950000" },
              { name: "Planet Her", artist: "Doja Cat", playcount: "780000" },
              { name: "Happier Than Ever", artist: "Billie Eilish", playcount: "920000" },
              { name: "Donda", artist: "Kanye West", playcount: "880000" },
              { name: "Future Nostalgia", artist: "Dua Lipa", playcount: "1050000" },
              { name: "Folklore", artist: "Taylor Swift", playcount: "1150000" },
              { name: "Positions", artist: "Ariana Grande", playcount: "890000" },
              { name: "After Hours", artist: "The Weeknd", playcount: "1020000" },
              { name: "Chromatica", artist: "Lady Gaga", playcount: "760000" },
              { name: "Evermore", artist: "Taylor Swift", playcount: "940000" },
              { name: "Justice", artist: "Justin Bieber", playcount: "870000" },
              { name: "Certified Lover Boy", artist: "Drake", playcount: "1130000" },
              { name: "Sour", artist: "Olivia Rodrigo", playcount: "1080000" },
              { name: "Red (Taylor's Version)", artist: "Taylor Swift", playcount: "960000" },
              { name: "Montero", artist: "Lil Nas X", playcount: "820000" },
              { name: "Call Me If You Get Lost", artist: "Tyler, The Creator", playcount: "740000" },
              { name: "Donda 2", artist: "Kanye West", playcount: "910000" },
              { name: "The Melodic Blue", artist: "Baby Keem", playcount: "680000" },
              { name: "An Evening With Silk Sonic", artist: "Silk Sonic", playcount: "790000" },
              { name: "Invasion of Privacy", artist: "Cardi B", playcount: "850000" },
              { name: "Sweetener", artist: "Ariana Grande", playcount: "920000" },
              { name: "thank u, next", artist: "Ariana Grande", playcount: "980000" },
              { name: "Lover", artist: "Taylor Swift", playcount: "1100000" },
              { name: "reputation", artist: "Taylor Swift", playcount: "1200000" },
              { name: "1989", artist: "Taylor Swift", playcount: "1300000" },
              { name: "Speak Now", artist: "Taylor Swift", playcount: "1000000" },
              { name: "Fearless", artist: "Taylor Swift", playcount: "950000" },
              { name: "Debut", artist: "Taylor Swift", playcount: "900000" },
              { name: "Good 4 U", artist: "Olivia Rodrigo", playcount: "850000" },
              { name: "Drivers License", artist: "Olivia Rodrigo", playcount: "800000" },
              { name: "Levitating", artist: "Dua Lipa", playcount: "750000" },
              { name: "Physical", artist: "Dua Lipa", playcount: "700000" },
              { name: "Blinding Lights", artist: "The Weeknd", playcount: "1200000" },
              { name: "Starboy", artist: "The Weeknd", playcount: "1100000" },
              { name: "Watermelon Sugar", artist: "Harry Styles", playcount: "1000000" },
              { name: "As It Was", artist: "Harry Styles", playcount: "950000" },
              { name: "Industry Baby", artist: "Lil Nas X", playcount: "900000" },
              { name: "Old Town Road", artist: "Lil Nas X", playcount: "850000" },
              { name: "Bad Guy", artist: "Billie Eilish", playcount: "800000" },
              { name: "Lovely", artist: "Billie Eilish", playcount: "750000" },
              { name: "WAP", artist: "Cardi B", playcount: "700000" },
              { name: "Bodak Yellow", artist: "Cardi B", playcount: "650000" },
              { name: "God's Plan", artist: "Drake", playcount: "1200000" },
              { name: "In My Feelings", artist: "Drake", playcount: "1100000" },
              { name: "One Dance", artist: "Drake", playcount: "1000000" },
              { name: "Hotline Bling", artist: "Drake", playcount: "950000" },
              { name: "Shape of You", artist: "Ed Sheeran", playcount: "1300000" },
              { name: "Perfect", artist: "Ed Sheeran", playcount: "1200000" },
              { name: "Thinking Out Loud", artist: "Ed Sheeran", playcount: "1100000" },
              { name: "Photograph", artist: "Ed Sheeran", playcount: "1000000" },
              { name: "Despacito", artist: "Luis Fonsi", playcount: "1500000" },
              { name: "Mi Gente", artist: "J Balvin", playcount: "1000000" },
              { name: "Con Calma", artist: "Daddy Yankee", playcount: "900000" },
              { name: "Taki Taki", artist: "DJ Snake", playcount: "800000" },
              { name: "Senorita", artist: "Shawn Mendes", playcount: "1200000" },
              { name: "Stitches", artist: "Shawn Mendes", playcount: "1000000" },
              { name: "There's Nothing Holdin' Me Back", artist: "Shawn Mendes", playcount: "900000" },
              { name: "Treat You Better", artist: "Shawn Mendes", playcount: "800000" },
              { name: "Closer", artist: "The Chainsmokers", playcount: "1100000" },
              { name: "Something Just Like This", artist: "The Chainsmokers", playcount: "1000000" },
              { name: "Don't Let Me Down", artist: "The Chainsmokers", playcount: "900000" },
              { name: "Roses", artist: "The Chainsmokers", playcount: "800000" },
              { name: "Havana", artist: "Camila Cabello", playcount: "1000000" },
              { name: "Señorita", artist: "Camila Cabello", playcount: "1200000" },
              { name: "Never Be the Same", artist: "Camila Cabello", playcount: "900000" },
              { name: "Crying in the Club", artist: "Camila Cabello", playcount: "800000" },
              { name: "Shake It Off", artist: "Taylor Swift", playcount: "1200000" },
              { name: "Blank Space", artist: "Taylor Swift", playcount: "1100000" },
              { name: "Look What You Made Me Do", artist: "Taylor Swift", playcount: "1000000" },
              { name: "We Are Never Ever Getting Back Together", artist: "Taylor Swift", playcount: "900000" },
              { name: "I Knew You Were Trouble", artist: "Taylor Swift", playcount: "800000" },
              { name: "22", artist: "Taylor Swift", playcount: "700000" },
              { name: "Love Story", artist: "Taylor Swift", playcount: "1300000" },
              { name: "You Belong With Me", artist: "Taylor Swift", playcount: "1200000" },
              { name: "Teardrops on My Guitar", artist: "Taylor Swift", playcount: "1100000" }
            ];

            // Generate 10 new albums for this page
            const newAlbums = [];
            for (let i = 0; i < 10; i++) {
              const templateIndex = ((page - 1) * 10 + i) % albumTemplates.length;
              const template = albumTemplates[templateIndex];
              newAlbums.push({
                name: `${template.name} (Page ${page})`,
                artist: template.artist,
                playcount: (parseInt(template.playcount) + (page * 10000) + (i * 1000)).toString()
              });
            }
            return newAlbums;
          };

          const mockAlbums = generateNewAlbums(page);

          // Fetch real album info with cover art for each album
          const albums = [];
          for (const album of mockAlbums) {
            try {
              const response = await fetch(`${LASTFM_BASE_URL}?method=album.getinfo&api_key=${LASTFM_API_KEY}&artist=${encodeURIComponent(album.artist)}&album=${encodeURIComponent(album.name)}&format=json`);
              const data = await response.json();
              
              if (data.album) {
                albums.push({
                  name: data.album.name || album.name,
                  artist: { name: data.album.artist || album.artist },
                  image: data.album.image || [{ "#text": "https://via.placeholder.com/300x300/333333/ffffff?text=No+Image" }],
                  playcount: album.playcount
                });
              } else {
                // Fallback if album not found
                albums.push({
                  name: album.name,
                  artist: { name: album.artist },
                  image: [{ "#text": "https://via.placeholder.com/300x300/333333/ffffff?text=No+Image" }],
                  playcount: album.playcount
                });
              }
            } catch (error) {
              console.error(`Error fetching album info for ${album.name}:`, error);
              // Fallback if API call fails
              albums.push({
                name: album.name,
                artist: { name: album.artist },
                image: [{ "#text": "https://via.placeholder.com/300x300/333333/ffffff?text=No+Image" }],
                playcount: album.playcount
              });
            }
          }
          
          if (page === 1) {
            loadingState.classList.add('d-none');
            albumsSection.classList.remove('d-none');
            albumsGrid.innerHTML = '';
          }

          // Render albums
          albums.forEach(album => {
            renderAlbumCard(album);
          });

          // Update pagination
          currentPage = page;
          hasMore = true; // Always show more button for demo purposes
          
          if (!hasMore) {
            loadMoreBtn.style.display = 'none';
          }

        } catch (error) {
          console.error('Error loading albums:', error);
          loadingState.classList.add('d-none');
          errorBox.classList.remove('d-none');
          errorBox.textContent = 'Albümler yüklenirken hata oluştu: ' + error.message;
        } finally {
          isLoading = false;
        }
      }

      // Render individual album card
      function renderAlbumCard(album) {
        const col = document.createElement('div');
        col.className = 'col-md-6 col-lg-4';
        
        const imageUrl = album.image?.[3]?.['#text'] || album.image?.[2]?.['#text'] || album.image?.[1]?.['#text'] || '';
        const albumName = album.name || 'Bilinmeyen Albüm';
        const artistName = album.artist?.name || 'Bilinmeyen Sanatçı';
        const playCount = album.playcount || '0';
        
        col.innerHTML = `
          <div class="card album-card h-100">
            <img src="${imageUrl}" class="album-cover" alt="${albumName}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=='">
            <div class="album-info">
              <h5 class="album-title">${albumName}</h5>
              <div class="album-artist">${artistName}</div>
              <div class="album-year">${playCount} dinlenme</div>
            </div>
            <div class="comment-section">
              <div class="mb-3">
                <h6 class="mb-2" data-lang="comments">Yorumlar</h6>
                <div class="comments-list" id="comments-${album.name.replace(/[^a-zA-Z0-9]/g, '')}">
                  <!-- Comments will be loaded here -->
                </div>
              </div>
              <div class="comment-form">
                <div class="input-group">
                  <input type="text" class="form-control comment-input" placeholder="Yorumunuzu yazın..." data-placeholder-lang="writeComment">
                  <button class="btn btn-primary add-comment-btn" type="button" data-album-id="${album.name.replace(/[^a-zA-Z0-9]/g, '')}" data-album-name="${albumName}" data-artist-name="${artistName}" data-lang="addComment">Ekle</button>
                </div>
              </div>
            </div>
          </div>
        `;
        
        albumsGrid.appendChild(col);
      }

      // Add comment function
      function addComment(albumId, albumName, artistName) {
        const input = document.querySelector(`#comments-${albumId}`).parentElement.querySelector('.comment-input');
        const commentText = input.value.trim();
        
        if (!commentText) return;
        
        // Get current user (you can implement proper auth later)
        const currentUser = localStorage.getItem('username') || 'Anonim Kullanıcı';
        
        // Create comment element
        const commentDiv = document.createElement('div');
        commentDiv.className = 'comment-item';
        commentDiv.innerHTML = `
          <div class="d-flex justify-content-between align-items-start">
            <div class="comment-author">${currentUser}</div>
            <div class="comment-date">${new Date().toLocaleDateString('tr-TR')}</div>
          </div>
          <div class="comment-text">${commentText}</div>
        `;
        
        // Add to comments list
        const commentsList = document.getElementById(`comments-${albumId}`);
        commentsList.appendChild(commentDiv);
        
        // Clear input
        input.value = '';
        
        // Save to localStorage (you can implement proper backend later)
        const commentsKey = `comments_${albumId}`;
        const existingComments = JSON.parse(localStorage.getItem(commentsKey) || '[]');
        existingComments.push({
          user: currentUser,
          text: commentText,
          date: new Date().toISOString()
        });
        localStorage.setItem(commentsKey, JSON.stringify(existingComments));
      }

      // Add event listeners for comment buttons
      function addCommentEventListeners() {
        document.addEventListener('click', function(e) {
          if (e.target.classList.contains('add-comment-btn')) {
            const albumId = e.target.getAttribute('data-album-id');
            const albumName = e.target.getAttribute('data-album-name');
            const artistName = e.target.getAttribute('data-artist-name');
            addComment(albumId, albumName, artistName);
          }
        });
      }

      // Load existing comments
      function loadComments(albumId) {
        const commentsKey = `comments_${albumId}`;
        const comments = JSON.parse(localStorage.getItem(commentsKey) || '[]');
        const commentsList = document.getElementById(`comments-${albumId}`);
        
        if (commentsList) {
          commentsList.innerHTML = comments.map(comment => `
            <div class="comment-item">
              <div class="d-flex justify-content-between align-items-start">
                <div class="comment-author">${comment.user}</div>
                <div class="comment-date">${new Date(comment.date).toLocaleDateString('tr-TR')}</div>
              </div>
              <div class="comment-text">${comment.text}</div>
            </div>
          `).join('');
        }
      }

      // Load more albums
      loadMoreBtn.addEventListener('click', () => {
        if (hasMore && !isLoading) {
          loadPopularAlbums(currentPage + 1);
        }
      });

      // Initialize
      addCommentEventListeners();
      loadPopularAlbums(1);

      // Load comments after a short delay to ensure DOM is ready
      setTimeout(() => {
        const albumCards = document.querySelectorAll('.album-card');
        albumCards.forEach(card => {
          const albumName = card.querySelector('.album-title').textContent;
          const albumId = albumName.replace(/[^a-zA-Z0-9]/g, '');
          loadComments(albumId);
        });
      }, 1000);
    })();
  </script>
</body>
</html>
