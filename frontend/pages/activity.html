<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aktivite Akışı — Nara Müzik</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Site CSS -->
  <link rel="stylesheet" href="../css/style.css">

  <style>
    :root{
      --bg:#0b0b0b;
      --text:#eaeaea;
      --panel:#121214;
      --muted:#9aa3ae;
      --accent:#77c2ff;
      --accent-contrast:#0a1118;
      --border: rgba(255,255,255,0.06);
      --elev-1: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      --input-bg:#0f1113;
    }
    :root[data-theme="light"]{
      --bg:#f8fafc;
      --text:#0f172a;
      --panel:#ffffff;
      --muted:#5b6778;
      --accent:#2563eb;
      --accent-contrast:#ffffff;
      --border: rgba(15,23,42,0.08);
      --elev-1: linear-gradient(180deg, rgba(2,6,23,0.02), rgba(2,6,23,0.01));
      --input-bg:#f1f5f9;
    }
    :root[data-theme="light"] .text-light{ color: var(--text) !important; }
    :root[data-theme="light"] .bg-dark{ background-color: var(--input-bg) !important; }
    :root[data-theme="light"] .form-control.bg-dark,
    :root[data-theme="light"] .form-select.bg-dark{ background-color: var(--input-bg) !important; color: var(--text) !important; border-color: var(--border) !important; }
    :root[data-theme="light"] .btn-outline-light{ color: var(--text) !important; border-color: var(--border) !important; }
    :root[data-theme="light"] .btn-outline-light:hover{ background: var(--text) !important; color: var(--accent-contrast) !important; }
    :root[data-theme="light"] .badge.bg-secondary{ background-color: color-mix(in oklab, var(--text) 10%, transparent) !important; color: var(--text) !important; }

    html,body{height:100%}
    body{
      background:var(--bg);
      color:var(--text);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      padding-top:72px;
    }
    .topbar{
      position:fixed; top:0; left:0; right:0; height:40px;
      background:var(--panel); z-index:1040;
      border-bottom:1px solid var(--border);
    }
    .topbar .container{height:100%; display:flex; align-items:center; gap:12px; font-size:13px}
    .mainnav{
      position:fixed; top:40px; left:0; right:0; z-index:1039;
      border-bottom:1px solid var(--border);
      background:transparent;
    }
    .navbar-brand{font-weight:800; letter-spacing:.6px}
    .nav-link{color:color-mix(in oklab, var(--text) 85%, transparent)}
    .nav-link:hover{color:var(--accent)}

    main.container{max-width:1150px}
    .card{background:var(--elev-1); border:1px solid var(--border)}
    .post-thumb{height:120px; object-fit:cover; width:100%; border-radius:.25rem}
    .section-header{display:flex; align-items:center; justify-content:space-between}
    .collapse-toggle{all:unset; cursor:pointer}

    @media (max-width:991px){
      .mainnav{top:0}
      body{padding-top:56px}
      .topbar{display:none}
    }
  </style>
</head>
<body>
  <!-- Üst ince bar -->
  <div class="topbar d-none d-lg-block">
    <div class="container">
      <div class="me-auto small text-muted">Nara Müzik — Müzik tartışma topluluğu</div>
      <div class="d-flex gap-3">
        <a href="../index.html#about" class="text-muted">About</a>
        <a href="contact.html" class="text-muted">Contact</a>
        <a href="submit.html" class="text-muted">Submit</a>
      </div>
    </div>
  </div>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark mainnav" id="mainNavbar">
    <div class="container-fluid">
      <div class="d-flex align-items-center">
        <button class="btn btn-outline-light me-2 d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sideMenu">☰</button>
        <a class="navbar-brand me-3" href="../index.html" data-lang="home">Nara Müzik</a>

        <!-- desktop links -->
        <div class="d-none d-lg-flex align-items-center gap-2">
          <a class="nav-link px-2" href="yenimuzik.html" data-lang="newMusic">Yeni Müzik</a>
          <a class="nav-link px-2" href="endustri.html" data-lang="industry">Endüstri Haberleri</a>
          <a class="nav-link px-2" href="degerlendirme.html" data-lang="review">Değerlendirme</a>
          <a class="nav-link px-2" href="album.html" data-lang="album">Albüm İnceleme</a>
          <a class="nav-link px-2" href="roportaj.html" data-lang="interview">Röportajlar</a>
          <a class="nav-link px-2" href="etkinlik.html" data-lang="event">Etkinlikler</a>
          <a class="nav-link px-2" href="dizifilm.html" data-lang="series">Dizi & Filmler</a>
        </div>
      </div>

      <div class="d-flex ms-auto align-items-center gap-2">
        <div class="d-none d-md-block">
          <input id="globalSearch" class="form-control form-control-sm bg-dark text-light border-0" style="width:220px" data-placeholder-lang="search" placeholder="Ara...">
        </div>
        <select id="language-toggle">
          <option value="en">EN</option>
          <option value="tr">TR</option>
        </select>
        <button id="themeToggle" class="btn btn-outline-light btn-sm">☀️</button>
        <button class="btn btn-success btn-sm d-none d-md-inline" data-bs-toggle="modal" data-bs-target="#createPostModal" data-lang="newPost">Yeni Gönderi</button>
        <div id="authButtons" class="d-flex gap-1">
          <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#loginModal">Giriş</button>
          <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#registerModal">Kayıt</button>
        </div>
        <div class="dropdown">
          <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" id="notifDropdownBtn" data-bs-toggle="dropdown" aria-expanded="false">🔔 Bildirimler</button>
          <ul class="dropdown-menu dropdown-menu-end" style="min-width: 320px; max-height: 360px; overflow:auto" aria-labelledby="notifDropdownBtn" id="notifMenu">
            <li class="px-3 py-2 text-muted small">Oturum açın veya bildiriminiz yok.</li>
          </ul>
        </div>
        <a href="submit.html" class="btn btn-outline-light btn-sm d-none d-md-inline" id="savedLink">Kaydedilenler</a>
        <a href="mod.html" class="btn btn-outline-warning btn-sm d-none d-md-inline" id="modLink">Mod</a>
      </div>
    </div>
  </nav>

  <!-- Mobil offcanvas menü -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sideMenu">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Kategoriler</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="list-unstyled mb-0">
        <li><a href="yenimuzik.html">Yeni Müzik</a></li>
        <li><a href="endustri.html">Endüstri Haberleri</a></li>
        <li><a href="degerlendirme.html">Değerlendirme</a></li>
        <li><a href="album.html">Albüm İnceleme</a></li>
        <li><a href="roportaj.html">Röportajlar</a></li>
        <li><a href="etkinlik.html">Etkinlikler</a></li>
        <li><a href="dizifilm.html">Dizi ve Filmler</a></li>
      </ul>
    </div>
  </div>

  <main class="container mt-4" id="activityMain">
    <h4 class="mb-3">Aktivite Akışı</h4>

    <!-- Bildirilerim -->
    <div class="card mb-3">
      <div class="card-header section-header">
        <span>🔔 Bildirilerim</span>
        <button class="collapse-toggle small text-muted" data-bs-toggle="collapse" data-bs-target="#collapseNotifications" aria-expanded="true" aria-controls="collapseNotifications">Gizle/Göster</button>
      </div>
      <div id="collapseNotifications" class="collapse show">
        <div class="card-body">
          <div id="activityNotifications" class="list-group small"></div>
        </div>
      </div>
    </div>

    <!-- Kaydedilenler -->
   <div class="card mb-3">
     <div class="card-header section-header">
       <span>🔖 Kaydedilenler</span>
       <button class="collapse-toggle small text-muted" data-bs-toggle="collapse" data-bs-target="#collapseBookmarks" aria-expanded="true" aria-controls="collapseBookmarks">Gizle/Göster</button>
     </div>
     <div id="collapseBookmarks" class="collapse show">
       <div class="card-body">
         <div id="activityBookmarks" class="row g-3"></div>
       </div>
     </div>
   </div>

    <!-- Gönderilerim -->
   <div class="card mb-3">
     <div class="card-header section-header">
       <span>✍️ Gönderilerim</span>
       <button class="collapse-toggle small text-muted" data-bs-toggle="collapse" data-bs-target="#collapseMyPosts" aria-expanded="true" aria-controls="collapseMyPosts">Gizle/Göster</button>
     </div>
     <div id="collapseMyPosts" class="collapse show">
       <div class="card-body">
         <div id="activityMyPosts" class="row g-3"></div>
       </div>
     </div>
   </div>

    <!-- Sitede En Son -->
   <div class="card mb-3">
     <div class="card-header section-header">
       <span>🆕 Sitede En Son</span>
       <div class="d-flex align-items-center gap-2">
         <small><a class="text-decoration-none" href="../index.html">Daha fazla</a></small>
         <button class="collapse-toggle small text-muted" data-bs-toggle="collapse" data-bs-target="#collapseLatest" aria-expanded="true" aria-controls="collapseLatest">Gizle/Göster</button>
       </div>
     </div>
     <div id="collapseLatest" class="collapse show">
       <div class="card-body">
         <div id="activityLatest" class="row g-3"></div>
       </div>
     </div>
   </div>
  </main>

  <!-- Footer -->
  <footer class="text-center py-4 mt-5">
    <div class="container">
      <small class="text-muted">© <span id="year"></span> Nara Müzik — Tüm hakları saklıdır.</small>
    </div>
  </footer>

  <!-- Modals (Login / Register / Create Post) -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="loginForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Giriş Yap</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="email" type="email" class="form-control mb-2" placeholder="Email" required>
          <input name="password" type="password" class="form-control" placeholder="Parola" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Giriş</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="registerForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Kayıt Ol</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="username" class="form-control mb-2" placeholder="Kullanıcı Adı" required>
          <input name="email" type="email" class="form-control mb-2" placeholder="Email" required>
          <input name="password" type="password" class="form-control" placeholder="Parola" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success w-100">Kayıt Ol</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="createPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <form id="newPostForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Yeni Gönderi Oluştur</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input id="postTitle" name="title" class="form-control mb-2" placeholder="Başlık" required>
          <select id="postCategory" name="category" class="form-select mb-2">
            <option value="yenimuzik">Yeni Müzik</option>
            <option value="endustri">Endüstri Haberleri</option>
            <option value="degerlendirme">Değerlendirme</option>
            <option value="album">Albüm İnceleme</option>
            <option value="roportaj">Röportajlar</option>
            <option value="etkinlik">Etkinlikler</option>
            <option value="dizifilm">Dizi & Filmler</option>
          </select>
          <div class="btn-toolbar mb-2" role="toolbar" aria-label="Editor toolbar">
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="bold" title="Kalın (Ctrl+B)"><strong>B</strong></button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="italic" title="İtalik (Ctrl+I)"><em>I</em></button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="strike" title="Üstü çizili">S</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="h2" title="Başlık H2">H2</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="h3" title="Başlık H3">H3</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="quote" title="Alıntı">“”</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="ul" title="Madde işaretli liste">• List</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="ol" title="Numaralı liste">1. List</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="task" title="Görev listesi">[ ]</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="link" title="Bağlantı (Ctrl+K)">Link</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="image" title="Resim">🖼️</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="code" title="Kod satırı"><code>{}</code></button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="codeblock" title="Kod bloğu">```</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="table" title="Tablo">▦</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="hr" title="Yatay çizgi">―</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="emoji" title="Emoji">😊</button>
            </div>
          </div>
          <div id="emojiPicker" class="card shadow-sm mb-2" style="display:none; position:absolute; z-index:2000; width:300px;">
            <div class="card-body py-2">
              <input type="text" class="form-control form-control-sm mb-2" id="emojiSearch" placeholder="Emoji ara…">
              <div id="emojiGrid" class="d-flex flex-wrap gap-1" style="max-height:200px; overflow:auto"></div>
            </div>
          </div>
          <div id="urlPopover" class="card shadow-sm mb-2" style="display:none; position:absolute; z-index:2000; width:320px;">
            <div class="card-body py-2">
              <div class="mb-2 small text-muted" id="urlPopoverTitle">Bağlantı ekle</div>
              <input type="url" class="form-control form-control-sm mb-2" id="urlPopoverInput" placeholder="https://...">
              <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-sm btn-outline-secondary" id="urlPopoverCancel">İptal</button>
                <button type="button" class="btn btn-sm btn-primary" id="urlPopoverOk">Ekle</button>
              </div>
            </div>
          </div>
          <div class="row g-2">
            <div class="col-md-6">
              <textarea id="postContent" name="content" rows="12" class="form-control" placeholder="İçerik (Markdown destekli)" required></textarea>
            </div>
            <div class="col-md-6">
              <div class="form-control" style="height:100%; overflow:auto; background: var(--input-bg); border-color: var(--border)">
                <div class="small text-muted mb-1">Önizleme</div>
                <div id="postPreview" class="markdown-body"></div>
              </div>
            </div>
          </div>
          <div class="row g-2">
            <div class="col-md-6">
              <input id="postMediaUrl" name="mediaUrl" type="url" class="form-control" placeholder="Fotoğraf/GIF URL (opsiyonel)">
            </div>
            <div class="col-md-6">
              <input id="postLinkUrl" name="linkUrl" type="url" class="form-control" placeholder="Harici Link (opsiyonel)">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Paylaş</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Post Detail Modal -->
  <div class="modal fade" id="postDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="postDetailTitle">Gönderi</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="small text-muted mb-2" id="postDetailMeta"></div>
          <div id="postDetailContent"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="../js/app.js"></script>
  <script src="../js/lang.js"></script>
  <script>
    (function(){
      'use strict';
      document.getElementById('year').textContent = new Date().getFullYear();

      // Tema uygulaması (index/diğer sayfalarla aynı mantık)
      const themeToggle = document.getElementById('themeToggle');
      const root = document.documentElement;
      function applyTheme(theme){
        const nav = document.getElementById('mainNavbar');
        if(theme === 'light'){
          root.setAttribute('data-theme','light');
          themeToggle.textContent = '🌙';
          nav.classList.remove('navbar-dark');
          nav.classList.add('navbar-light');
        } else {
          root.removeAttribute('data-theme');
          themeToggle.textContent = '☀️';
          nav.classList.remove('navbar-light');
          nav.classList.add('navbar-dark');
        }
      }
      const savedTheme = localStorage.getItem('theme') || 'dark';
      applyTheme(savedTheme);
      themeToggle.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        localStorage.setItem('theme', next);
        applyTheme(next);
      });

      // Auth gate
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      const token = localStorage.getItem('token') || null;
      const main = document.getElementById('activityMain');
      if (!user || !token){
        main.innerHTML = `
          <div class="d-flex align-items-center justify-content-center" style="min-height:50vh">
            <div class="card shadow-sm" style="max-width:520px">
              <div class="card-body text-center">
                <h5 class="mb-2">Aktivite akışını görmek için giriş yapın.</h5>
                <p class="text-muted small mb-3">Bildirimleriniz, kaydedilenleriniz ve kendi gönderileriniz burada görünecek.</p>
                <div class="d-flex justify-content-center gap-2">
                  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal">Giriş</button>
                  <a class="btn btn-outline-light" href="../index.html">Ana sayfa</a>
                </div>
              </div>
            </div>
          </div>
        `;
        return;
      }

      // Helpers
      const BASE = (typeof BACKEND_BASE !== 'undefined' && BACKEND_BASE) ? BACKEND_BASE : (location.hostname.includes('localhost') ? 'http://localhost:4000' : 'https://naramusic.onrender.com');
      const authHeaders = { 'Authorization': 'Bearer ' + token };
      const basePath = location.pathname.includes('/pages/') ? '' : 'pages/';

      const elNotif = document.getElementById('activityNotifications');
      const elBmk = document.getElementById('activityBookmarks');
      const elMine = document.getElementById('activityMyPosts');
      const elLatest = document.getElementById('activityLatest');

      function fmtDate(d){ try{ return new Date(d).toLocaleString('tr-TR'); }catch(_){ return ''; } }
      function postCardHtml(p){
        const thumb = p.mediaUrl ? `<img src="${p.mediaUrl}" alt="" class="post-thumb mb-2">` : '';
        const linkBtn = p.linkUrl ? `<a href="${p.linkUrl}" target="_blank" class="btn btn-sm btn-outline-secondary">Bağlantı</a>` : '';
        const tags = Array.isArray(p.tags) ? p.tags.map(t=>`<span class="badge bg-dark ms-1">#${t}</span>`).join('') : '';
        return `
          <div class="col-md-6">
            <div class="card h-100 shadow-sm" data-post-id="${p.id}">
              <div class="card-body">
                ${p.pinned?'<span class="badge bg-warning text-dark me-1">📌 Sabit</span>':''}${p.locked?'<span class="badge bg-secondary me-1">🔒 Kilitli</span>':''}
                ${thumb}
                <h5 class="card-title">${p.title||''}</h5>
                <div class="mb-2">
                  <span class="badge bg-secondary">${p.category||''}</span>
                  ${tags}
                </div>
                <p class="card-text">${(p.content||'').substring(0,150)}...</p>
                <div class="small text-muted">${fmtDate(p.createdAt||0)} • ${p.authorName||''}</div>
                ${linkBtn ? `<div class="mt-2">${linkBtn}</div>` : ''}
                <div class="mt-2 d-flex gap-2">
                  <button class="btn btn-sm btn-outline-light like-btn" data-id="${p.id}">👍 ${p.likes||0}</button>
                  <button class="btn btn-sm btn-outline-light bookmark-btn" data-id="${p.id}">🔖 Kaydet</button>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      function renderNotifications(items){
        if (!Array.isArray(items) || !items.length){
          const el = document.getElementById('activityNotifications');
          el.innerHTML = '<div class="text-muted">Bildiriminiz yok.</div>';
          return;
        }
        elNotif.innerHTML = items.map(n=>{
          const type = n.type==='mention' ? 'Bahsetme' : (n.type || 'Bildirim');
          const from = n.fromUser ? ('@'+n.fromUser) : '';
          const badge = n.read ? '' : '<span class="badge bg-primary ms-2">Yeni</span>';
          return `
            <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
              <div>
                <strong>${type}</strong> ${from ? '• '+from : ''} <small class="text-muted">• ${fmtDate(n.createdAt)}</small>
              </div>
              <div>${badge}</div>
            </a>
          `;
        }).join('');
      }

      function renderPosts(list, into){
        if (!Array.isArray(list) || !list.length){
          into.innerHTML = '<div class="col-12"><div class="text-muted">İçerik yok.</div></div>';
          return;
        }
        into.innerHTML = list.map(postCardHtml).join('');
        if (typeof window.attachPostCardHandlers === 'function'){
          attachPostCardHandlers(into);
        }
      }

      (async ()=>{
        try{
          const latestUrl = new URL(BASE.replace(/\/$/, '') + '/api/posts');
          latestUrl.searchParams.set('limit','10');
          const requests = [
            fetch(BASE + '/api/notifications', { headers: authHeaders }),
            fetch(BASE + '/api/users/me/bookmarks', { headers: authHeaders }),
            fetch(BASE + '/api/users/' + encodeURIComponent(user.id) + '/posts'),
            fetch(latestUrl.toString())
          ];
          const [rN, rB, rM, rL] = await Promise.allSettled(requests);

          // Notifications
          if (rN.status === 'fulfilled'){
            const items = await rN.value.json();
            renderNotifications(Array.isArray(items) ? items : []);
          } else {
            elNotif.innerHTML = '<div class="text-danger small">Bildiriler yüklenemedi.</div>';
          }

          // Bookmarks
          if (rB.status === 'fulfilled'){
            const items = await rB.value.json();
            renderPosts(Array.isArray(items) ? items : [], elBmk);
          } else {
            elBmk.innerHTML = '<div class="col-12"><div class="text-danger small">Kaydedilenler yüklenemedi.</div></div>';
          }

          // My posts
          if (rM.status === 'fulfilled'){
            const items = await rM.value.json();
            renderPosts(Array.isArray(items) ? items : [], elMine);
          } else {
            elMine.innerHTML = '<div class="col-12"><div class="text-danger small">Gönderileriniz yüklenemedi.</div></div>';
          }

          // Latest
          if (rL.status === 'fulfilled'){
            const data = await rL.value.json();
            const items = Array.isArray(data?.items) ? data.items : (Array.isArray(data)?data:[]);
            renderPosts(items, elLatest);
          } else {
            elLatest.innerHTML = '<div class="col-12"><div class="text-danger small">En son gönderiler yüklenemedi.</div></div>';
          }

        }catch(err){
          console.error('Activity load error', err);
          elNotif.innerHTML = '<div class="text-danger small">Bildiriler yüklenemedi.</div>';
          elBmk.innerHTML = '<div class="col-12"><div class="text-danger small">Kaydedilenler yüklenemedi.</div></div>';
          elMine.innerHTML = '<div class="col-12"><div class="text-danger small">Gönderileriniz yüklenemedi.</div></div>';
          elLatest.innerHTML = '<div class="col-12"><div class="text-danger small">En son gönderiler yüklenemedi.</div></div>';
        }
      })();
    })();
  </script>
</body>
</html>