<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kullanıcı</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    body{ background:#0b0b0b; color:#eaeaea; padding-top:64px; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial }
    .card{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.06) }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark fixed-top"><div class="container-fluid"><a class="navbar-brand" href="../index.html">Nara Müzik</a></div></nav>
  <main class="container mt-4">
    <div class="row g-4">
      <div class="col-lg-4">
        <div class="card p-3">
          <div class="d-flex align-items-center gap-3">
            <div class="rounded-circle bg-secondary" style="width:64px;height:64px"></div>
            <div>
              <h5 id="uName" class="mb-1">Kullanıcı</h5>
              <div class="text-muted small" id="uMeta"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-8">
        <h5 class="mb-2">Gönderiler</h5>
        <div class="row g-3" id="userPosts"></div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const BACKEND_BASE = location.hostname.includes('localhost')? 'http://localhost:4000':'https://naramusic.onrender.com';
    const params = new URLSearchParams(location.search);
    const userId = params.get('uid');
    const userName = params.get('name');
    (async ()=>{
      try{
        const ur = await fetch(`${BACKEND_BASE}/api/users/${encodeURIComponent(userId)}`);
        const u = await ur.json();
        document.getElementById('uName').textContent = u.username || userName || 'Kullanıcı';
        document.getElementById('uMeta').innerHTML = u.email ? `${u.email}` : '';
        const avatar = u.avatarUrl || ('https://ui-avatars.com/api/?name='+encodeURIComponent(u.username||'U')+'&background=0D8ABC&color=fff');
        const img = document.createElement('img'); img.src = avatar; img.className = 'rounded-circle'; img.style.width='64px'; img.style.height='64px'; img.style.objectFit='cover';
        document.querySelector('.card.p-3 .d-flex.align-items-center.gap-3').insertBefore(img, document.querySelector('.card.p-3 .d-flex.align-items-center.gap-3').children[0]);
      }catch(e){}
    })();

    (async ()=>{
      try{
        const r = await fetch(`${BACKEND_BASE}/api/users/${encodeURIComponent(userId)}/posts`);
        const posts = await r.json();
        const el = document.getElementById('userPosts');
        if(!posts.length){ el.innerHTML = '<p>Henüz gönderi yok.</p>'; return; }
        el.innerHTML = posts.map(p=>{
          const thumb = p.mediaUrl ? `<img src="${p.mediaUrl}" class=\"post-thumb mb-2\" alt=\"\">` : '';
          return `
            <div class=\"col-12\">
              <article class=\"card p-3\">
                ${thumb}
                <h6 class=\"mb-1\"><a class=\"link-light text-decoration-none\" href=\"post.html?id=${p.id}\">${p.title}</a></h6>
                <div class=\"meta text-muted small mb-1\">${new Date(p.createdAt).toLocaleString()} • ${p.category}</div>
                <p class=\"mb-0 text-truncate\">${p.content}</p>
              </article>
            </div>
          `;
        }).join('');
      }catch(err){ console.error(err); }
    })();
  </script>
</body>
</html>


