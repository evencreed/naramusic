<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kullanƒ±cƒ± Profili ‚Äî Nara M√ºzik</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    :root{ --bg:#0b0b0b; --text:#eaeaea; --panel:#121214; --muted:#9aa3ae; --accent:#77c2ff; --accent-contrast:#0a1118; --border: rgba(255,255,255,0.06); --elev-1: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); --input-bg:#0f1113; }
    :root[data-theme="light"]{ --bg:#f8fafc; --text:#0f172a; --panel:#ffffff; --muted:#5b6778; --accent:#2563eb; --accent-contrast:#ffffff; --border: rgba(15,23,42,0.08); --elev-1: linear-gradient(180deg, rgba(2,6,23,0.02), rgba(2,6,23,0.01)); --input-bg:#f1f5f9; }
    html,body{height:100%}
    body{ background:var(--bg); color:var(--text); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; padding-top:72px; }
    .mainnav{ position:fixed; top:0; left:0; right:0; z-index:1039; border-bottom:1px solid var(--border); background:transparent; }
    .card{ background:var(--elev-1); border:1px solid var(--border) }
    :root[data-theme="light"] .text-light{ color: var(--text) !important }
    :root[data-theme="light"] .bg-dark{ background-color: var(--input-bg) !important }
    :root[data-theme="light"] .form-control.bg-dark,
    :root[data-theme="light"] .form-select.bg-dark{ background-color: var(--input-bg) !important; color: var(--text) !important; border-color: var(--border) !important }
    :root[data-theme="light"] .btn-outline-light{ color: var(--text) !important; border-color: var(--border) !important }
    :root[data-theme="light"] .btn-outline-light:hover{ background: var(--text) !important; color: var(--accent-contrast) !important }
    /* Force white text in dark mode specifically for profile page */
    :root:not([data-theme="light"]) body,
    :root:not([data-theme="light"]) .card,
    :root:not([data-theme="light"]) .card * {
      color:#ffffff !important;
    }
    :root:not([data-theme="light"]) .text-muted { color:#cbd5e1 !important; }
    :root:not([data-theme="light"]) .form-control,
    :root:not([data-theme="light"]) .form-select { color:#ffffff !important; background-color:#0f1113 !important; border-color: rgba(255,255,255,0.12) !important; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark mainnav" id="mainNavbar">
    <div class="container-fluid">
      <div class="d-flex align-items-center">
        <button class="btn btn-outline-light me-2 d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sideMenu">‚ò∞</button>
        <a class="navbar-brand me-3" href="../index.html">Nara M√ºzik</a>

        <!-- desktop links -->
        <div class="d-none d-lg-flex align-items-center gap-2">
          <a class="nav-link px-2" href="yenimuzik.html">Yeni M√ºzik</a>
          <a class="nav-link px-2" href="endustri.html">End√ºstri Haberleri</a>
          <a class="nav-link px-2" href="degerlendirme.html">Deƒüerlendirme</a>
          <a class="nav-link px-2" href="album.html">Alb√ºm ƒ∞nceleme</a>
          <a class="nav-link px-2" href="roportaj.html">R√∂portajlar</a>
          <a class="nav-link px-2" href="etkinlik.html">Etkinlikler</a>
          <a class="nav-link px-2" href="dizifilm.html">Dizi & Filmler</a>
        </div>
      </div>

      <div class="d-flex ms-auto align-items-center gap-2">
        <div class="d-none d-md-block">
          <input id="globalSearch" class="form-control form-control-sm bg-dark text-light border-0" style="width:220px" placeholder="Ara...">
        </div>

        <select id="languageSwitcher" class="form-select form-select-sm bg-dark text-light border-light d-none d-md-block" style="width:110px">
          <option value="tr">TR</option>
          <option value="en">EN</option>
        </select>

        <button id="themeToggle" class="btn btn-outline-light btn-sm">‚òÄÔ∏è</button>
        <button class="btn btn-success btn-sm d-none d-md-inline" data-bs-toggle="modal" data-bs-target="#createPostModal">Yeni G√∂nderi</button>

        <div id="authButtons" class="d-flex gap-1">
          <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#loginModal">Giri≈ü</button>
          <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#registerModal">Kayƒ±t</button>
        </div>
        <div class="dropdown">
          <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" id="notifDropdownBtn" data-bs-toggle="dropdown" aria-expanded="false">üîî Bildirimler</button>
          <ul class="dropdown-menu dropdown-menu-end" style="min-width: 320px; max-height: 360px; overflow:auto" aria-labelledby="notifDropdownBtn" id="notifMenu">
            <li class="px-3 py-2 text-muted small">Oturum a√ßƒ±n veya bildiriminiz yok.</li>
          </ul>
        </div>
        <a href="profil.html" class="btn btn-outline-light btn-sm d-none d-md-inline" id="savedLink">Kaydedilenler</a>
        <a href="mod.html" class="btn btn-outline-warning btn-sm d-none d-md-inline" id="modLink">Mod</a>
      </div>
    </div>
  </nav>

  <!-- Offcanvas sidebar for small screens -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sideMenu">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Kategoriler</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="list-unstyled mb-0">
        <li><a href="yenimuzik.html">Yeni M√ºzik</a></li>
        <li><a href="endustri.html">End√ºstri Haberleri</a></li>
        <li><a href="degerlendirme.html">Deƒüerlendirme</a></li>
        <li><a href="album.html">Alb√ºm ƒ∞nceleme</a></li>
        <li><a href="roportaj.html">R√∂portajlar</a></li>
        <li><a href="etkinlik.html">Etkinlikler</a></li>
        <li><a href="dizifilm.html">Dizi ve Filmler</a></li>
      </ul>
    </div>
  </div>

  <main class="container mt-4">
    <div class="row g-4">
      <div class="col-lg-4">
        <div class="card p-3">
          <div class="d-flex align-items-center gap-3">
            <img id="profAvatar" class="rounded-circle" style="width:64px;height:64px; object-fit:cover" src="" alt="avatar">
            <div>
              <h5 id="profUsername" class="mb-1">Kullanƒ±cƒ± <span id="profRole" class="badge bg-dark ms-2 d-none"></span></h5>
              <div id="profMeta" class="text-muted small"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-8">
        <h5 class="mb-2">G√∂nderiler</h5>
        <div class="row g-3" id="userPosts"></div>
      </div>
    </div>
  </main>

  <footer class="text-center py-4 mt-5">
    <div class="container">
      <small class="text-muted">¬© <span id="year"></span> Nara M√ºzik ‚Äî T√ºm haklarƒ± saklƒ±dƒ±r.</small>
    </div>
  </footer>

  <!-- Modals (Login / Register / Create Post) -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="loginForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Giri≈ü Yap</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="email" type="email" class="form-control mb-2" placeholder="Email" required>
          <input name="password" type="password" class="form-control" placeholder="Parola" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Giri≈ü</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="registerForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Kayƒ±t Ol</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input name="username" class="form-control mb-2" placeholder="Kullanƒ±cƒ± Adƒ±" required>
          <input name="email" type="email" class="form-control mb-2" placeholder="Email" required>
          <input name="password" type="password" class="form-control" placeholder="Parola" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success w-100">Kayƒ±t Ol</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal fade" id="createPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <form id="newPostForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Yeni G√∂nderi Olu≈ütur</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input id="postTitle" name="title" class="form-control mb-2" placeholder="Ba≈ülƒ±k" required>
          <select id="postCategory" name="category" class="form-select mb-2">
            <option value="yenimuzik">Yeni M√ºzik</option>
            <option value="endustri">End√ºstri Haberleri</option>
            <option value="degerlendirme">Deƒüerlendirme</option>
          </select>
          <div class="btn-toolbar mb-2" role="toolbar" aria-label="Editor toolbar">
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="bold" title="Kalƒ±n (Ctrl+B)"><strong>B</strong></button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="italic" title="ƒ∞talik (Ctrl+I)"><em>I</em></button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="strike" title="√úst√º √ßizili">S</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="h2" title="Ba≈ülƒ±k H2">H2</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="h3" title="Ba≈ülƒ±k H3">H3</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="quote" title="Alƒ±ntƒ±">""</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="ul" title="Madde i≈üaretli liste">‚Ä¢ List</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="ol" title="Numaralƒ± liste">1. List</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="task" title="G√∂rev listesi">[ ]</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="link" title="Baƒülantƒ± (Ctrl+K)">Link</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="image" title="Resim">üñºÔ∏è</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="code" title="Kod satƒ±rƒ±"><code>{}</code></button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="codeblock" title="Kod bloƒüu">```</button>
            </div>
            <div class="btn-group btn-group-sm me-1" role="group">
              <button type="button" class="btn btn-outline-secondary" data-md-btn="table" title="Tablo">‚ñ¶</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="hr" title="Yatay √ßizgi">‚Äï</button>
              <button type="button" class="btn btn-outline-secondary" data-md-btn="emoji" title="Emoji">üòä</button>
            </div>
          </div>
          <div id="emojiPicker" class="card shadow-sm mb-2" style="display:none; position:absolute; z-index:2000; width:300px;">
            <div class="card-body py-2">
              <input type="text" class="form-control form-control-sm mb-2" id="emojiSearch" placeholder="Emoji ara‚Ä¶">
              <div id="emojiGrid" class="d-flex flex-wrap gap-1" style="max-height:200px; overflow:auto"></div>
            </div>
          </div>
          <div id="urlPopover" class="card shadow-sm mb-2" style="display:none; position:absolute; z-index:2000; width:320px;">
            <div class="card-body py-2">
              <div class="mb-2 small text-muted" id="urlPopoverTitle">Baƒülantƒ± ekle</div>
              <input type="url" class="form-control form-control-sm mb-2" id="urlPopoverInput" placeholder="https://...">
              <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-sm btn-outline-secondary" id="urlPopoverCancel">ƒ∞ptal</button>
                <button type="button" class="btn btn-sm btn-primary" id="urlPopoverOk">Ekle</button>
              </div>
            </div>
          </div>
          <div class="row g-2">
            <div class="col-md-6">
              <textarea id="postContent" name="content" rows="12" class="form-control" placeholder="ƒ∞√ßerik (Markdown destekli)" required></textarea>
            </div>
            <div class="col-md-6">
              <div class="form-control" style="height:100%; overflow:auto; background: var(--input-bg); border-color: var(--border)">
                <div class="small text-muted mb-1">√ñnizleme</div>
                <div id="postPreview" class="markdown-body"></div>
              </div>
            </div>
          </div>
          <div class="row g-2">
            <div class="col-md-6">
              <input id="postMediaUrl" name="mediaUrl" type="url" class="form-control" placeholder="Fotoƒüraf/GIF URL (opsiyonel)">
            </div>
            <div class="col-md-6">
              <input id="postLinkUrl" name="linkUrl" type="url" class="form-control" placeholder="Harici Link (opsiyonel)">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Payla≈ü</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Post Detail Modal -->
  <div class="modal fade" id="postDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="postDetailTitle">G√∂nderi</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="small text-muted mb-2" id="postDetailMeta"></div>
          <div id="postDetailContent"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="../js/app.js"></script>
  <script src="../js/lang.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    const root = document.documentElement; const savedTheme = localStorage.getItem('theme') || 'dark';
    function applyTheme(theme){ const nav = document.getElementById('mainNavbar'); if(theme==='light'){ root.setAttribute('data-theme','light'); nav.classList.remove('navbar-dark'); nav.classList.add('navbar-light'); document.getElementById('themeToggle').textContent='üåô'; } else { root.removeAttribute('data-theme'); nav.classList.remove('navbar-light'); nav.classList.add('navbar-dark'); document.getElementById('themeToggle').textContent='‚òÄÔ∏è'; } }
    applyTheme(savedTheme);
    document.getElementById('themeToggle').addEventListener('click',()=>{ const next = root.getAttribute('data-theme')==='light' ? 'dark':'light'; localStorage.setItem('theme', next); applyTheme(next); });

    const BACKEND_BASE = location.hostname.includes('localhost')? 'http://localhost:4000':'https://naramusic.onrender.com';
    const params = new URLSearchParams(location.search);
    const userId = params.get('uid');
    const userName = params.get('name');

    if (!userId) {
      document.querySelector('main').innerHTML = '<div class="alert alert-danger">Ge√ßersiz kullanƒ±cƒ± ID.</div>';
    } else {
      (async ()=>{
        try{
          const ur = await fetch(`${BACKEND_BASE}/api/users/${encodeURIComponent(userId)}`);
          if (!ur.ok) throw new Error('User not found');
          const u = await ur.json();
          document.getElementById('profUsername').firstChild.nodeValue = u.username || userName || 'Kullanƒ±cƒ±';
          const roleBadge = document.getElementById('profRole');
          if (roleBadge && u.role){
            const role = u.role;
            roleBadge.textContent = role;
            roleBadge.classList.remove('d-none');
            if (role==='superadmin'){ roleBadge.classList.add('bg-danger'); }
            else if (role==='admin'){ roleBadge.classList.add('bg-warning'); }
            else if (role==='moderator'){ roleBadge.classList.add('bg-primary'); }
          }
          const joinDate = u.createdAt ? new Date(u.createdAt).toLocaleDateString('tr-TR') : '';
          document.getElementById('profMeta').textContent = joinDate ? `Katƒ±lma tarihi: ${joinDate}` : '';
          const avatar = u.avatarUrl || ('https://ui-avatars.com/api/?name='+encodeURIComponent(u.username||'U')+'&background=0D8ABC&color=fff');
          document.getElementById('profAvatar').src = avatar;
        }catch(e){
          document.querySelector('main').innerHTML = '<div class="alert alert-danger">Kullanƒ±cƒ± bulunamadƒ±.</div>';
        }
      })();

      (async ()=>{
        try{
          const r = await fetch(`${BACKEND_BASE}/api/users/${encodeURIComponent(userId)}/posts`);
          const posts = await r.json();
          const el = document.getElementById('userPosts');
          if(!posts.length){ el.innerHTML = '<p>Hen√ºz g√∂nderi yok.</p>'; return; }
          el.innerHTML = posts.map(p=>{
            const thumb = p.mediaUrl ? `<img src="${p.mediaUrl}" class="post-thumb mb-2" alt="">` : '';
            return `
              <div class="col-12">
                <article class="card p-3">
                  ${thumb}
                  <h6 class="mb-1"><a class="link-light text-decoration-none" href="post.html?id=${p.id}">${p.title}</a></h6>
                  <div class="meta text-muted small mb-1">${new Date(p.createdAt).toLocaleString()} ‚Ä¢ ${p.category}</div>
                  <p class="mb-0 text-truncate">${p.content}</p>
                </article>
              </div>
            `;
          }).join('');
        }catch(err){ console.error(err); }
      })();
    }
  </script>
</body>
</html>
