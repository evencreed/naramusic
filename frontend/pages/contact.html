<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ƒ∞leti≈üim ‚Äî Nara M√ºzik</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    :root{ --bg:#0b0b0b; --text:#eaeaea; --panel:#121214; --muted:#9aa3ae; --accent:#77c2ff; --border: rgba(255,255,255,0.06); }
    :root[data-theme="light"]{ --bg:#f8fafc; --text:#0f172a; --panel:#ffffff; --muted:#5b6778; --accent:#2563eb; --border: rgba(15,23,42,0.08); }
    body{ background:var(--bg); color:var(--text); padding-top:72px; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; }
    .mainnav{ position:fixed; top:0; left:0; right:0; border-bottom:1px solid var(--border); }
    /* Dark theme navbar styles */
    :root:not([data-theme="light"]) .mainnav {
      background: #000000 !important;
    }
    :root:not([data-theme="light"]) .mainnav .navbar-brand,
    :root:not([data-theme="light"]) .mainnav .nav-link,
    :root:not([data-theme="light"]) .mainnav a,
    :root:not([data-theme="light"]) .mainnav .btn,
    :root:not([data-theme="light"]) .mainnav .form-control,
    :root:not([data-theme="light"]) .mainnav .form-select {
      color: #ffffff !important;
    }
    :root:not([data-theme="light"]) .mainnav .navbar-brand:hover,
    :root:not([data-theme="light"]) .mainnav .nav-link:hover,
    :root:not([data-theme="light"]) .mainnav a:hover {
      color: #cccccc !important;
    }
    
    /* Sidebar styles */
    .sidebar .widget{background:transparent; border:1px solid var(--border); padding:14px; margin-bottom:16px}
    .sidebar h6{font-size:14px; margin-bottom:10px}
    .small-list .item{display:flex; gap:10px; align-items:flex-start; margin-bottom:10px}
    .small-list img{width:72px; height:56px; object-fit:cover; border-radius:4px}
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark mainnav" id="mainNavbar">
    <div class="container-fluid">
      <a class="navbar-brand" href="../index.html" data-lang="home">Nara M√ºzik</a>
      <div class="ms-auto d-flex align-items-center gap-2">
        <select id="language-toggle">
          <option value="en">EN</option>
          <option value="tr">TR</option>
        </select>
        <button id="themeToggle" class="btn btn-outline-light btn-sm">‚òÄÔ∏è</button>
      </div>
    </div>
  </nav>

  <main class="container mt-4">
    <div class="row g-4">
      <!-- Left: Contact Form -->
      <div class="col-lg-8">
        <h4 class="mb-3" data-lang="contact">ƒ∞leti≈üim</h4>
        <p class="text-muted" data-lang="contactMessage">Bize mesaj bƒ±rakƒ±n; evencreed hesabƒ±nƒ±n gelen kutusuna d√º≈üecek.</p>
        <form id="contactForm" class="card p-3">
          <input id="cName" name="name" class="form-control mb-2" data-placeholder-lang="name" placeholder="Adƒ±nƒ±z" required>
          <input id="cEmail" name="email" type="email" class="form-control mb-2" data-placeholder-lang="email" placeholder="Email" required>
          <textarea id="cMessage" name="message" rows="6" class="form-control mb-3" data-placeholder-lang="message" placeholder="Mesajƒ±nƒ±z" required></textarea>
          <button type="submit" class="btn btn-primary" data-lang="send">G√∂nder</button>
        </form>
        <div id="contactResult" class="mt-3"></div>
      </div>

      <!-- Right: Sidebar -->
      <aside class="col-lg-4 sidebar">
        <div class="widget">
          <h6>üîç Pop√ºler</h6>
          <div class="small-list" id="sidebarPopularPosts">
            <div class="text-center py-3">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Y√ºkleniyor...</span>
              </div>
              <div class="small text-muted mt-2">Pop√ºler g√∂nderiler y√ºkleniyor...</div>
            </div>
          </div>
        </div>

        <div class="widget">
          <h6>üßæ Son Yorumlar</h6>
          <div class="small-list" id="sidebarRecentComments">
            <div class="text-center py-3">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Y√ºkleniyor...</span>
              </div>
              <div class="small text-muted mt-2">Son yorumlar y√ºkleniyor...</div>
            </div>
          </div>
        </div>

        <div class="widget">
          <h6>üóÇ Kategoriler</h6>
          <div class="d-flex flex-wrap gap-2">
            <a href="yenimuzik.html" class="badge bg-secondary text-light">Yeni M√ºzik</a>
            <a href="endustri.html" class="badge bg-secondary text-light">End√ºstri</a>
            <a href="degerlendirme.html" class="badge bg-secondary text-light">Deƒüerlendirme</a>
            <a href="album.html" class="badge bg-secondary text-light">Alb√ºm</a>
            <a href="roportaj.html" class="badge bg-secondary text-light">R√∂portaj</a>
            <a href="etkinlik.html" class="badge bg-secondary text-light">Etkinlik</a>
            <a href="dizifilm.html" class="badge bg-secondary text-light">Dizi&Film</a>
          </div>
        </div>

        <div class="widget text-center">
          <h6>Topluluk</h6>
          <p class="small text-muted mb-0">√úyeler katƒ±lƒ±p g√∂nderi payla≈üabilir. Giri≈ü/Kayƒ±t ile ba≈ülayƒ±n.</p>
          <div class="mt-2">
            <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#registerModal">√úye Ol</button>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/app.js"></script>
  <script src="../js/lang.js"></script>
  <script>
    const form = document.getElementById('contactForm');
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const name = document.getElementById('cName').value;
      const email = document.getElementById('cEmail').value;
      const message = document.getElementById('cMessage').value;
      try{
        const base = typeof BACKEND_BASE !== 'undefined' ? BACKEND_BASE : 'http://localhost:4000';
        const r = await fetch(`${base}/api/contact`, { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ name,email,message }) });
        const data = await r.json();
        if(data.ok){ document.getElementById('contactResult').innerHTML = '<div class="alert alert-success">Mesajƒ±nƒ±z iletildi.</div>'; form.reset(); }
        else { document.getElementById('contactResult').innerHTML = '<div class="alert alert-danger">G√∂nderilemedi: '+(data.error||'hata')+'</div>'; }
      }catch(err){ document.getElementById('contactResult').innerHTML = '<div class="alert alert-danger">Baƒülantƒ± hatasƒ±</div>'; }
    });

    // Load sidebar data
    async function loadSidebarData() {
      try {
        const base = (typeof window !== 'undefined' && window.__API_BASE__) ? window.__API_BASE__ : (location.hostname.includes('localhost') ? 'http://localhost:4000' : 'https://naramusic.onrender.com');
        
        // Load popular posts for sidebar
        const popularRes = await fetch(`${base}/api/posts/popular?limit=3`);
        const popularPosts = await popularRes.json();
        
        const sidebarPopular = document.getElementById('sidebarPopularPosts');
        if (popularPosts.length > 0) {
          sidebarPopular.innerHTML = popularPosts.map(post => `
            <div class="item">
              <img src="${post.imageUrl || 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=400&auto=format&fit=crop'}" alt="${post.title}" style="width: 50px; height: 50px; object-fit: cover;">
              <div>
                <div class="fw-semibold">${post.title}</div>
                <div class="meta">${post.views || 0} okuma</div>
              </div>
            </div>
          `).join('');
        } else {
          sidebarPopular.innerHTML = '<div class="text-muted small">Hen√ºz pop√ºler g√∂nderi yok.</div>';
        }

        // Load recent comments for sidebar
        const commentsRes = await fetch(`${base}/api/comments/recent?limit=3`);
        const recentComments = await commentsRes.json();
        
        const sidebarComments = document.getElementById('sidebarRecentComments');
        if (recentComments.length > 0) {
          sidebarComments.innerHTML = recentComments.map(comment => `
            <div class="item">
              <div>
                <div class="fw-semibold">${comment.author || 'Anonim'}</div>
                <div class="meta">"${comment.content.substring(0, 50)}${comment.content.length > 50 ? '...' : ''}" ‚Ä¢ ${new Date(comment.createdAt).toLocaleDateString('tr-TR')}</div>
              </div>
            </div>
          `).join('');
        } else {
          sidebarComments.innerHTML = '<div class="text-muted small">Hen√ºz yorum yok.</div>';
        }

      } catch (error) {
        console.error('Sidebar data loading error:', error);
        
        // Show error state
        document.getElementById('sidebarPopularPosts').innerHTML = '<div class="text-muted small">Veri y√ºklenemedi.</div>';
        document.getElementById('sidebarRecentComments').innerHTML = '<div class="text-muted small">Veri y√ºklenemedi.</div>';
      }
    }

    // Load sidebar data on page load
    loadSidebarData();
  </script>
</body>
</html>


