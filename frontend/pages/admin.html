<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yönetim Paneli — Nara Müzik</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    .kpi-card .kpi { font-size: 1.6rem; font-weight: 700; }
    .kpi-card .label { color: var(--muted, #9aa3ae); font-size: .9rem; }
    .text-muted-small { color: var(--muted, #9aa3ae); font-size: .85rem; }
    .spark { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; white-space: pre; }
    .table td, .table th { vertical-align: middle; }
    .truncate-200 { max-width: 260px; display: inline-block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark mainnav" id="mainNavbar">
    <div class="container-fluid">
      <a class="navbar-brand" href="../index.html" data-lang="home">Nara Müzik</a>
      <div class="ms-auto d-flex align-items-center gap-2">
        <select id="language-toggle">
          <option value="en">EN</option>
          <option value="tr">TR</option>
        </select>
        <button id="themeToggle" class="btn btn-outline-light btn-sm">🌙</button>
        <a href="submit.html" class="btn btn-outline-light btn-sm d-none d-md-inline" id="savedLink" data-lang="saved">Kaydedilenler</a>
        <a href="mod.html" class="btn btn-outline-warning btn-sm d-none d-md-inline" id="modLink" data-lang="mod">Mod</a>
        <div id="authButtons" class="d-flex gap-1">
          <button class="btn btn-outline-light btn-sm" onclick="location.href='../index.html#login'" data-lang="login">Giriş</button>
          <button class="btn btn-outline-light btn-sm" onclick="location.href='../index.html#register'" data-lang="register">Kayıt</button>
        </div>
      </div>
    </div>
  </nav>

  <main class="container mt-4" id="gate">
    <div class="d-flex align-items-center justify-content-center" style="min-height:50vh">
      <div class="card shadow-sm" style="max-width:520px">
        <div class="card-body text-center">
          <h5 class="mb-2">Yönetim paneline erişim için admin girişi gereklidir.</h5>
          <p class="text-muted small mb-3">Sadece yetkili kullanıcılar bu alanı görüntüleyebilir.</p>
          <div class="d-flex justify-content-center gap-2">
            <button class="btn btn-primary" onclick="location.href='../index.html#login'">Giriş Yap</button>
            <a class="btn btn-outline-light" href="../index.html">Ana sayfa</a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <template id="dashboardTpl">
    <section class="mb-3">
      <h4 class="mb-0">Yönetim Paneli</h4>
      <div class="text-muted-small" id="generatedLine"></div>
    </section>

    <!-- KPIs -->
    <section class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="card kpi-card">
          <div class="card-body text-center">
            <div class="kpi" id="totalUsers">-</div>
            <div class="label">Toplam Kullanıcı</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card kpi-card">
          <div class="card-body text-center">
            <div class="kpi" id="totalPosts">-</div>
            <div class="label">Toplam Gönderi</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card kpi-card">
          <div class="card-body text-center">
            <div class="kpi" id="totalComments">-</div>
            <div class="label">Toplam Yorum</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card kpi-card">
          <div class="card-body text-center">
            <div class="kpi" id="totalReports">-</div>
            <div class="label">Toplam Rapor</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Controls -->
    <section class="mb-3">
      <div class="row g-2 align-items-center">
        <div class="col-auto">
          <label class="form-label mb-0">Tarih Aralığı:</label>
        </div>
        <div class="col-auto">
          <select id="rangeSelect" class="form-select form-select-sm">
            <option value="7">Son 7 gün</option>
            <option value="30" selected>Son 30 gün</option>
            <option value="90">Son 90 gün</option>
        </select>
        </div>
        <div class="col-auto">
          <button id="refreshBtn" class="btn btn-sm btn-outline-primary">Yenile</button>
        </div>
      </div>
    </section>

    <!-- Analytics -->
    <div class="row g-4 mb-4">
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0">Kategori Dağılımı</h6>
          </div>
          <div class="card-body">
            <div id="categoryDistribution"></div>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0">Günlük Gönderiler</h6>
          </div>
          <div class="card-body">
            <div class="spark" id="dailyPosts"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tables -->
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0">En Çok Görüntülenen Gönderiler</h6>
          </div>
          <div class="card-body">
      <div class="table-responsive">
              <table class="table table-sm">
          <thead>
            <tr>
                    <th>Başlık</th>
                    <th>Görüntüleme</th>
            </tr>
          </thead>
                <tbody id="topPostsTable"></tbody>
        </table>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0">Son Gönderiler</h6>
          </div>
          <div class="card-body">
      <div class="table-responsive">
              <table class="table table-sm">
          <thead>
            <tr>
                    <th>Başlık</th>
              <th>Tarih</th>
            </tr>
          </thead>
                <tbody id="recentPostsTable"></tbody>
        </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </template>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/app.js"></script>
  <script src="../js/lang.js"></script>
  <script>
  (async function(){
    'use strict';
    
    // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const root = document.documentElement;
        function applyTheme(theme){
      const nav = document.getElementById('mainNavbar');
          if(theme === 'light'){
            root.setAttribute('data-theme','light');
        themeToggle.textContent = '🌙';
        nav.classList.remove('navbar-dark'); nav.classList.add('navbar-light');
          } else {
            root.removeAttribute('data-theme');
        themeToggle.textContent = '☀️';
        nav.classList.remove('navbar-light'); nav.classList.add('navbar-dark');
          }
        }
        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);
          themeToggle.addEventListener('click', () => {
            const next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      localStorage.setItem('theme', next); applyTheme(next);
    });

    // Admin gate - check if user is admin
    let CURRENT_USER = null;
    try{ CURRENT_USER = JSON.parse(localStorage.getItem('user')||'null'); }catch(_){}
    
    if (!CURRENT_USER || !['admin', 'superadmin'].includes(CURRENT_USER.role)){
      // Show access denied message (already in HTML)
      return;
    }

    // Load dashboard template
    const gate = document.getElementById('gate');
    const template = document.getElementById('dashboardTpl');
    gate.innerHTML = template.innerHTML;
    
    // Initialize dashboard functionality
    document.getElementById('generatedLine').textContent = `Son güncelleme: ${new Date().toLocaleString('tr-TR')}`;
    
    // Mock data for demo
    document.getElementById('totalUsers').textContent = '1,234';
    document.getElementById('totalPosts').textContent = '5,678';
    document.getElementById('totalComments').textContent = '12,345';
    document.getElementById('totalReports').textContent = '23';
    
    document.getElementById('categoryDistribution').innerHTML = `
      <ul class="list-unstyled mb-0">
        <li><span class="badge bg-primary me-2">452</span> Yeni Müzik</li>
        <li><span class="badge bg-success me-2">321</span> Endüstri Haberleri</li>
        <li><span class="badge bg-info me-2">289</span> Değerlendirme</li>
        <li><span class="badge bg-warning me-2">234</span> Albüm İnceleme</li>
        <li><span class="badge bg-secondary me-2">156</span> Röportajlar</li>
      </ul>
    `;
    
    document.getElementById('dailyPosts').textContent = '▁▂▃▅▄▇▆▃▂▄▅▇▆▄▃▂▁▂▃▄▅▆▇▅▄▃▂▁▂▃▄▅▆▇';
    
    // Sample table data
    document.getElementById('topPostsTable').innerHTML = `
      <tr><td class="truncate-200">En İyi Albümler 2024</td><td>1,234</td></tr>
      <tr><td class="truncate-200">Spotify Wrapped Analizi</td><td>987</td></tr>
      <tr><td class="truncate-200">Rock Müziğin Gelişimi</td><td>856</td></tr>
    `;
    
    document.getElementById('recentPostsTable').innerHTML = `
      <tr><td class="truncate-200">Yeni Çıkan Albümler</td><td>2 saat önce</td></tr>
      <tr><td class="truncate-200">Konser Yorumları</td><td>4 saat önce</td></tr>
      <tr><td class="truncate-200">Müzik Trends 2024</td><td>6 saat önce</td></tr>
    `;
    
    // Event listeners
    document.getElementById('refreshBtn').addEventListener('click', () => {
      document.getElementById('generatedLine').textContent = `Son güncelleme: ${new Date().toLocaleString('tr-TR')}`;
    });
    
    })();
  </script>
</body>
</html>